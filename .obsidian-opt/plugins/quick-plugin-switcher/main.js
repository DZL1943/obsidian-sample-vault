/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/
var en=Object.create;var Se=Object.defineProperty;var tn=Object.getOwnPropertyDescriptor;var nn=Object.getOwnPropertyNames;var sn=Object.getPrototypeOf,on=Object.prototype.hasOwnProperty;var an=(s,n)=>()=>(n||s((n={exports:{}}).exports,n),n.exports),ln=(s,n)=>{for(var e in n)Se(s,e,{get:n[e],enumerable:!0})},lt=(s,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of nn(n))!on.call(s,i)&&i!==e&&Se(s,i,{get:()=>n[i],enumerable:!(t=tn(n,i))||t.enumerable});return s};var Ye=(s,n,e)=>(e=s!=null?en(sn(s)):{},lt(n||!s||!s.__esModule?Se(e,"default",{value:s,enumerable:!0}):e,s)),rn=s=>lt(Se({},"__esModule",{value:!0}),s);var Gt=an((At,Re)=>{(function(s){let n;function e(u,c){let p=u.charCodeAt(c);if(isNaN(p))throw new RangeError("Index "+c+' out of range for string "'+u+'"; please open an issue at https://github.com/Trott/slug/issues/new');if(p<55296||p>57343)return[u.charAt(c),c];if(p>=55296&&p<=56319){if(u.length<=c+1)return[" ",c];let g=u.charCodeAt(c+1);return g<56320||g>57343?[" ",c]:[u.charAt(c)+u.charAt(c+1),c+1]}if(c===0)return[" ",c];let d=u.charCodeAt(c-1);if(d<55296||d>56319)return[" ",c];throw new Error('String "'+u+'" reaches code believed to be unreachable; please open an issue at https://github.com/Trott/slug/issues/new')}typeof window!="undefined"?window.btoa?n=function(u){return btoa(unescape(encodeURIComponent(u)))}:n=function(u){let c=unescape(encodeURIComponent(u+"")),p="";for(let d,g,f=0,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.charAt(f|0)||(b="=",f%1);p+=b.charAt(63&d>>8-f%1*8)){if(g=c.charCodeAt(f+=3/4),g>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");d=d<<8|g}return p}:n=function(u){return Buffer.from(u).toString("base64")};function t(u,c){let p=a(u,c);if((c&&c.fallback!==void 0?c.fallback:t.defaults.fallback)===!0&&p===""){let g="";for(let f=0;f<u.length;f++){let b=e(u,f);f=b[1],g+=b[0]}p=a(n(g),c)}return p}let i={bg:{\u0419:"Y",\u0439:"y",X:"H",x:"h",\u0426:"Ts",\u0446:"ts",\u0429:"Sht",\u0449:"sht",\u042A:"A",\u044A:"a",\u042C:"Y",\u044C:"y"},de:{\u00C4:"AE",\u00E4:"ae",\u00D6:"OE",\u00F6:"oe",\u00DC:"UE",\u00FC:"ue"},sr:{\u0111:"dj",\u0110:"DJ"},uk:{\u0418:"Y",\u0438:"y",\u0419:"Y",\u0439:"y",\u0426:"Ts",\u0446:"ts",\u0425:"Kh",\u0445:"kh",\u0429:"Shch",\u0449:"shch",\u0413:"H",\u0433:"h"}},o={};function a(u,c){if(typeof u!="string")throw new Error("slug() requires a string argument, received "+typeof u);typeof c=="string"&&(c={replacement:c}),c=c?Object.assign({},c):{},c.mode=c.mode||t.defaults.mode;let p=t.defaults.modes[c.mode],d=["replacement","multicharmap","charmap","remove","lower","trim"];for(let w,S=0,B=d.length;S<B;S++)w=d[S],c[w]=w in c?c[w]:p[w];let g=i[c.locale]||o,f=[];for(let w in c.multicharmap){if(!Object.prototype.hasOwnProperty.call(c.multicharmap,w))continue;let S=w.length;f.indexOf(S)===-1&&f.push(S)}f=f.sort(function(w,S){return S-w});let b=c.mode==="rfc3986"?/[^\w\s\-.~]/:/[^A-Za-z0-9\s]/,M="";for(let w,S=0,B=u.length;S<B;S++){w=u[S];let te=!1;for(let ue=0;ue<f.length;ue++){let pe=f[ue],de=u.substr(S,pe);if(c.multicharmap[de]){S+=pe-1,w=c.multicharmap[de],te=!0;break}}te||(g[w]?w=g[w]:c.charmap[w]?w=c.charmap[w].replace(c.replacement," "):w.includes(c.replacement)?w=w.replace(c.replacement," "):w=w.replace(b,"")),M+=w}return c.remove&&(M=M.replace(c.remove,"")),c.trim&&(M=M.trim()),M=M.replace(/\s+/g,c.replacement),c.lower&&(M=M.toLowerCase()),M}let l={\u092B\u093C:"Fi",\u0917\u093C:"Ghi",\u0916\u093C:"Khi",\u0915\u093C:"Qi",\u0921\u093C:"ugDha",\u0922\u093C:"ugDhha",\u092F\u093C:"Yi",\u091C\u093C:"Za",\u05D1\u05B4\u05D9:"i",\u05D1\u05B5:"e",\u05D1\u05B5\u05D9:"e",\u05D1\u05B6:"e",\u05D1\u05B7:"a",\u05D1\u05B8:"a",\u05D1\u05B9:"o",\u05D5\u05B9:"o",\u05D1\u05BB:"u",\u05D5\u05BC:"u",\u05D1\u05BC:"b",\u05DB\u05BC:"k",\u05DA\u05BC:"k",\u05E4\u05BC:"p",\u05E9\u05C1:"sh",\u05E9\u05C2:"s",\u05D1\u05B0:"e",\u05D7\u05B1:"e",\u05D7\u05B2:"a",\u05D7\u05B3:"o",\u05D1\u05B4:"i"},r={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00C6:"AE",\u00C7:"C",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00D0:"D",\u00D1:"N",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u0150:"O",\u00D8:"O",\u014C:"O",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u0170:"U",\u00DD:"Y",\u00DE:"TH",\u00DF:"ss",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00E6:"ae",\u00E7:"c",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00F0:"d",\u00F1:"n",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u0151:"o",\u00F8:"o",\u014D:"o",\u0152:"OE",\u0153:"oe",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u0171:"u",\u00FD:"y",\u00FE:"th",\u00FF:"y","\u1E9E":"SS",\u03B1:"a",\u03B2:"b",\u03B3:"g",\u03B4:"d",\u03B5:"e",\u03B6:"z",\u03B7:"h",\u03B8:"th",\u03B9:"i",\u03BA:"k",\u03BB:"l",\u03BC:"m",\u03BD:"n",\u03BE:"3",\u03BF:"o",\u03C0:"p",\u03C1:"r",\u03C3:"s",\u03C4:"t",\u03C5:"y",\u03C6:"f",\u03C7:"x",\u03C8:"ps",\u03C9:"w",\u03AC:"a",\u03AD:"e",\u03AF:"i",\u03CC:"o",\u03CD:"y",\u03AE:"h",\u03CE:"w",\u03C2:"s",\u03CA:"i",\u03B0:"y",\u03CB:"y",\u0390:"i",\u0391:"A",\u0392:"B",\u0393:"G",\u0394:"D",\u0395:"E",\u0396:"Z",\u0397:"H",\u0398:"Th",\u0399:"I",\u039A:"K",\u039B:"L",\u039C:"M",\u039D:"N",\u039E:"3",\u039F:"O",\u03A0:"P",\u03A1:"R",\u03A3:"S",\u03A4:"T",\u03A5:"Y",\u03A6:"F",\u03A7:"X",\u03A8:"PS",\u03A9:"W",\u0386:"A",\u0388:"E",\u038A:"I",\u038C:"O",\u038E:"Y",\u0389:"H",\u038F:"W",\u03AA:"I",\u03AB:"Y",\u015F:"s",\u015E:"S",\u0131:"i",\u0130:"I",\u011F:"g",\u011E:"G",\u0430:"a",\u0431:"b",\u0432:"v",\u0433:"g",\u0434:"d",\u0435:"e",\u0451:"yo",\u0436:"zh",\u0437:"z",\u0438:"i",\u0439:"j",\u043A:"k",\u043B:"l",\u043C:"m",\u043D:"n",\u043E:"o",\u043F:"p",\u0440:"r",\u0441:"s",\u0442:"t",\u0443:"u",\u0444:"f",\u0445:"h",\u0446:"c",\u0447:"ch",\u0448:"sh",\u0449:"sh",\u044A:"u",\u044B:"y",\u044C:"",\u044D:"e",\u044E:"yu",\u044F:"ya",\u0410:"A",\u0411:"B",\u0412:"V",\u0413:"G",\u0414:"D",\u0415:"E",\u0401:"Yo",\u0416:"Zh",\u0417:"Z",\u0418:"I",\u0419:"J",\u041A:"K",\u041B:"L",\u041C:"M",\u041D:"N",\u041E:"O",\u041F:"P",\u0420:"R",\u0421:"S",\u0422:"T",\u0423:"U",\u0424:"F",\u0425:"H",\u0426:"C",\u0427:"Ch",\u0428:"Sh",\u0429:"Sh",\u042A:"U",\u042B:"Y",\u042C:"",\u042D:"E",\u042E:"Yu",\u042F:"Ya",\u0404:"Ye",\u0406:"I",\u0407:"Yi",\u0490:"G",\u0454:"ye",\u0456:"i",\u0457:"yi",\u0491:"g",\u010D:"c",\u010F:"d",\u011B:"e",\u0148:"n",\u0159:"r",\u0161:"s",\u0165:"t",\u016F:"u",\u017E:"z",\u010C:"C",\u010E:"D",\u011A:"E",\u0147:"N",\u0158:"R",\u0160:"S",\u0164:"T",\u016E:"U",\u017D:"Z",\u013E:"l",\u013A:"l",\u0155:"r",\u013D:"L",\u0139:"L",\u0154:"R",\u0105:"a",\u0107:"c",\u0119:"e",\u0142:"l",\u0144:"n",\u015B:"s",\u017A:"z",\u017C:"z",\u0104:"A",\u0106:"C",\u0118:"E",\u0141:"L",\u0143:"N",\u015A:"S",\u0179:"Z",\u017B:"Z",\u0101:"a",\u0113:"e",\u0123:"g",\u012B:"i",\u0137:"k",\u013C:"l",\u0146:"n",\u016B:"u",\u0100:"A",\u0112:"E",\u0122:"G",\u012A:"I",\u0136:"K",\u013B:"L",\u0145:"N",\u016A:"U",\u0623:"a",\u0625:"i",\u0628:"b",\u062A:"t",\u062B:"th",\u062C:"g",\u062D:"h",\u062E:"kh",\u062F:"d",\u0630:"th",\u0631:"r",\u0632:"z",\u0633:"s",\u0634:"sh",\u0635:"s",\u0636:"d",\u0637:"t",\u0638:"th",\u0639:"aa",\u063A:"gh",\u0641:"f",\u0642:"k",\u0643:"k",\u0644:"l",\u0645:"m",\u0646:"n",\u0647:"h",\u0648:"o",\u064A:"y",\u0621:"aa",\u0629:"a",\u0622:"a",\u0627:"a",\u067E:"p",\u0698:"zh",\u06AF:"g",\u0686:"ch",\u06A9:"k",\u06CC:"i",\u0117:"e",\u012F:"i",\u0173:"u",\u0116:"E",\u012E:"I",\u0172:"U",\u021B:"t",\u021A:"T",\u0163:"t",\u0162:"T",\u0219:"s",\u0218:"S",\u0103:"a",\u0102:"A",\u1EA0:"A",\u1EA2:"A",\u1EA6:"A",\u1EA4:"A",\u1EAC:"A",\u1EA8:"A",\u1EAA:"A",\u1EB0:"A",\u1EAE:"A",\u1EB6:"A",\u1EB2:"A",\u1EB4:"A",\u1EB8:"E",\u1EBA:"E",\u1EBC:"E",\u1EC0:"E",\u1EBE:"E",\u1EC6:"E",\u1EC2:"E",\u1EC4:"E",\u1ECA:"I",\u1EC8:"I",\u0128:"I",\u1ECC:"O",\u1ECE:"O",\u1ED2:"O",\u1ED0:"O",\u1ED8:"O",\u1ED4:"O",\u1ED6:"O",\u01A0:"O",\u1EDC:"O",\u1EDA:"O",\u1EE2:"O",\u1EDE:"O",\u1EE0:"O",\u1EE4:"U",\u1EE6:"U",\u0168:"U",\u01AF:"U",\u1EEA:"U",\u1EE8:"U",\u1EF0:"U",\u1EEC:"U",\u1EEE:"U",\u1EF2:"Y",\u1EF4:"Y",\u1EF6:"Y",\u1EF8:"Y",\u0110:"D",\u1EA1:"a",\u1EA3:"a",\u1EA7:"a",\u1EA5:"a",\u1EAD:"a",\u1EA9:"a",\u1EAB:"a",\u1EB1:"a",\u1EAF:"a",\u1EB7:"a",\u1EB3:"a",\u1EB5:"a",\u1EB9:"e",\u1EBB:"e",\u1EBD:"e",\u1EC1:"e",\u1EBF:"e",\u1EC7:"e",\u1EC3:"e",\u1EC5:"e",\u1ECB:"i",\u1EC9:"i",\u0129:"i",\u1ECD:"o",\u1ECF:"o",\u1ED3:"o",\u1ED1:"o",\u1ED9:"o",\u1ED5:"o",\u1ED7:"o",\u01A1:"o",\u1EDD:"o",\u1EDB:"o",\u1EE3:"o",\u1EDF:"o",\u1EE1:"o",\u1EE5:"u",\u1EE7:"u",\u0169:"u",\u01B0:"u",\u1EEB:"u",\u1EE9:"u",\u1EF1:"u",\u1EED:"u",\u1EEF:"u",\u1EF3:"y",\u1EF5:"y",\u1EF7:"y",\u1EF9:"y",\u0111:"d",\u04D8:"AE",\u04D9:"ae",\u0492:"GH",\u0493:"gh",\u049A:"KH",\u049B:"kh",\u04A2:"NG",\u04A3:"ng",\u04AE:"UE",\u04AF:"ue",\u04B0:"U",\u04B1:"u",\u04BA:"H",\u04BB:"h",\u04E8:"OE",\u04E9:"oe",\u0452:"dj",\u0458:"j",\u0459:"lj",\u045A:"nj",\u045B:"c",\u045F:"dz",\u0402:"Dj",\u0408:"j",\u0409:"Lj",\u040A:"Nj",\u040B:"C",\u040F:"Dz",\u01CC:"nj",\u01C9:"lj",\u01CB:"NJ",\u01C8:"LJ",\u0905:"a",\u0906:"aa",\u090F:"e",\u0908:"ii",\u090D:"ei",\u090E:"ae",\u0910:"ai",\u0907:"i",\u0913:"o",\u0911:"oi",\u0912:"oii",\u090A:"uu",\u0914:"ou",\u0909:"u",\u092C:"B",\u092D:"Bha",\u091A:"Ca",\u091B:"Chha",\u0921:"Da",\u0922:"Dha",\u092B:"Fa",\u0917:"Ga",\u0918:"Gha",\u0917\u093C:"Ghi",\u0939:"Ha",\u091C:"Ja",\u091D:"Jha",\u0915:"Ka",\u0916:"Kha",\u0916\u093C:"Khi",\u0932:"L",\u0933:"Li",\u090C:"Li",\u0934:"Lii",\u0961:"Lii",\u092E:"Ma",\u0928:"Na",\u0919:"Na",\u091E:"Nia",\u0923:"Nae",\u0929:"Ni",\u0950:"oms",\u092A:"Pa",\u0915\u093C:"Qi",\u0930:"Ra",\u090B:"Ri",\u0960:"Ri",\u0931:"Ri",\u0938:"Sa",\u0936:"Sha",\u0937:"Shha",\u091F:"Ta",\u0924:"Ta",\u0920:"Tha",\u0926:"Tha",\u0925:"Tha",\u0927:"Thha",\u0921\u093C:"ugDha",\u0922\u093C:"ugDhha",\u0935:"Va",\u092F:"Ya",\u092F\u093C:"Yi",\u091C\u093C:"Za",\u0259:"e",\u018F:"E",\u10D0:"a",\u10D1:"b",\u10D2:"g",\u10D3:"d",\u10D4:"e",\u10D5:"v",\u10D6:"z",\u10D7:"t",\u10D8:"i",\u10D9:"k",\u10DA:"l",\u10DB:"m",\u10DC:"n",\u10DD:"o",\u10DE:"p",\u10DF:"zh",\u10E0:"r",\u10E1:"s",\u10E2:"t",\u10E3:"u",\u10E4:"p",\u10E5:"k",\u10E6:"gh",\u10E7:"q",\u10E8:"sh",\u10E9:"ch",\u10EA:"ts",\u10EB:"dz",\u10EC:"ts",\u10ED:"ch",\u10EE:"kh",\u10EF:"j",\u10F0:"h",\u05D1:"v",\u05D2\u05BC:"g",\u05D2:"g",\u05D3:"d",\u05D3\u05BC:"d",\u05D4:"h",\u05D5:"v",\u05D6:"z",\u05D7:"h",\u05D8:"t",\u05D9:"y",\u05DB:"kh",\u05DA:"kh",\u05DC:"l",\u05DE:"m",\u05DD:"m",\u05E0:"n",\u05DF:"n",\u05E1:"s",\u05E4:"f",\u05E3:"f",\u05E5:"ts",\u05E6:"ts",\u05E7:"k",\u05E8:"r",\u05EA\u05BC:"t",\u05EA:"t"};t.charmap=Object.assign({},r),t.multicharmap=Object.assign({},l),t.defaults={charmap:t.charmap,mode:"pretty",modes:{rfc3986:{replacement:"-",remove:null,lower:!0,charmap:t.charmap,multicharmap:t.multicharmap,trim:!0},pretty:{replacement:"-",remove:null,lower:!0,charmap:t.charmap,multicharmap:t.multicharmap,trim:!0}},multicharmap:t.multicharmap,fallback:!0},t.reset=function(){t.defaults.modes.rfc3986.charmap=t.defaults.modes.pretty.charmap=t.charmap=t.defaults.charmap=Object.assign({},r),t.defaults.modes.rfc3986.multicharmap=t.defaults.modes.pretty.multicharmap=t.multicharmap=t.defaults.multicharmap=Object.assign({},l),o=""},t.extend=function(u){let c=Object.keys(u),p={},d={};for(let g=0;g<c.length;g++)c[g].length>1?p[c[g]]=u[c[g]]:d[c[g]]=u[c[g]];Object.assign(t.charmap,d),Object.assign(t.multicharmap,p)},t.setLocale=function(u){o=i[u]||{}},typeof Re!="undefined"&&Re.exports?Re.exports=t:s.slug=t})(At)});var Fn={};ln(Fn,{default:()=>We});module.exports=rn(Fn);var Pe=require("obsidian");function ze(s,n){let e=Object.keys(n).map(t=>cn(s,t,n[t]));return e.length===1?e[0]:function(){e.forEach(t=>t())}}function cn(s,n,e){let t=s[n],i=s.hasOwnProperty(n),o=e(t);return t&&Object.setPrototypeOf(o,t),Object.setPrototypeOf(a,o),s[n]=a,l;function a(...r){return o===t&&s[n]===a&&l(),o.apply(this,r)}function l(){s[n]===a&&(i?s[n]=t:delete s[n]),o!==t&&(o=t,Object.setPrototypeOf(a,t||Function))}}var k=require("obsidian");function x(s,n){return s.app.plugins.enabledPlugins.has(n)}function ne(s,n){let e=s.indexOf(n);return e>-1&&s.splice(e,1),s}function rt(s,n=3){let t=[{suffix:"T",threshold:1e12},{suffix:"B",threshold:1e9},{suffix:"M",threshold:1e6},{suffix:"K",threshold:1e3},{suffix:"",threshold:1}].find(i=>Math.abs(s)>=i.threshold);if(t){let i=s/t.threshold;return(t.suffix===""?i:i.toFixed(n))+t.suffix}return s.toString()}function ct(s){if(isNaN(s.getTime()))return"Invalid date";let n=Math.abs(new Date().getTime()-s.getTime())/1e3,e=Math.floor(n/(86400*365));if(e>=2)return`${e} years ago`;if(e===1)return"1 year ago";let t=Math.floor(n/(86400*30));if(t>=2)return`${t} months ago`;if(t===1)return"1 month ago";let i=Math.floor(n/86400);if(i>=2)return`${i} days ago`;if(i===1)return"1 day ago";let o=Math.floor(n/3600)%24;if(o>=2)return`${o} hours ago`;if(o===1)return"1 hour ago";let a=Math.floor(n/60)%60;return a>=2?`${a} minutes ago`:a===1?"1 minute ago":"seconds ago"}function ut(s,n){for(let e in s)if(e.startsWith(n))return!0;return!1}function z(){let s=window.getSelection();return s==null?void 0:s.toString()}function pt(s){let n=atob(s),e=n.length,t=new Uint8Array(e),i=0;for(let o of n)t[i++]=o.charCodeAt(0);return t}var y=require("obsidian");var H=require("fs"),C=require("obsidian");var _=require("obsidian");var dt="https://raw.githubusercontent.com/obsidianmd/obsidian-releases/master/community-plugins.json",gt="https://raw.githubusercontent.com/obsidianmd/obsidian-releases/master/community-plugin-stats.json",E={all:"all",enabled:"enabled",disabled:"disabled",enabledFirst:"enabledFirst",mostSwitched:"mostSwitched",byGroup:"byGroup",hidden:"hidden"},D={all:"all",notInstalled:"notInstalled",installed:"installed",byGroup:"byGroup",hidden:"hidden",hasNote:"hasNote"},J=(t=>(t[t.Desktop=0]="Desktop",t[t.Mobile=1]="Mobile",t[t.Both=2]="Both",t))(J||{}),Je={Downloads:"by downloads",Alpha:"by alphanum",Updated:"by (recent) update",Released:"by (recent) release"},L={SelectGroup:"All"},U={SelectGroup:"All"},ft={lastFetchExe:0,savedVersion:"0.0.0",installed:{},wasEnabled:[],sortBy:"Downloads",filters:"All",selectedGroup:"SelectGroup",search:"",numberOfGroups:4,groups:{},showHotKeys:!0,pluginStats:{},plugins:[],commPlugins:{},filtersComm:"All",selectedGroupComm:"SelectGroup",numberOfGroupsComm:4,groupsComm:{},byAuthor:!1,invertFiltersComm:!1,commPluginsNotesFolder:"",keepDropDownValues:!0};var v=require("obsidian");var Ee=(s,n)=>{let{plugin:e}=s,{settings:t}=e;s instanceof P&&t.filters===E.byGroup?i(L,e.lengthAll):s instanceof O&&t.filtersComm===D.byGroup&&i(U,Object.keys(t.commPlugins).length);function i(o,a){let l={};for(let r in o){let u=$(r);r==="SelectGroup"?l[r]=o[r]+`(${a})`:Te(u,s)||(l[r]=F(u).emoji+o[r])}new v.DropdownComponent(n).addOptions(l).setValue(t.selectedGroup).onChange(async r=>{t.selectedGroup=r,await m(s)})}},_e=(s,n,e,t)=>{var u;let{plugin:i}=s,{settings:o}=i,a=(((u=o.groups[n])==null?void 0:u.time)||0).toString(),l=he(e,a);if(!l)return;l.onblur=async()=>{await r(l,o,n,e,s)},l.onkeydown=async c=>{c.key==="Enter"&&await r(l,o,n,e,s)};let r=async(c,p,d,g,f)=>{let b=parseInt(c.value)||0;p.groups[d].time=b,g.textContent=`${b}`,t.length&&await un(t,d,f),await m(f)}},un=async(s,n,e)=>{var a;let{plugin:t}=e,{settings:i}=t,{installed:o}=i;for(let l of s){o[l].time=(a=i.groups[n])==null?void 0:a.time;let r=!!o[l].time;o[l].delayed=r,i.groups[n].applied=r,o[l].enabled&&(await e.app.plugins.disablePluginAndSave(l),r?await e.app.plugins.enablePlugin(l):await e.app.plugins.enablePluginAndSave(l),o[l].enabled=!0)}},pn=(s,n,e,t)=>{let{plugin:i}=n,{settings:o}=i,{installed:a}=o,l=G(n,e),r=new v.Menu;r.addItem(p=>p.setTitle("Delay group (or dblclick icon)").onClick(()=>{_e(n,e,t,l)})),r.addSeparator(),r.addItem(p=>p.setTitle("Show/hide group content").onClick(async()=>{await me(n,e,l)})),r.addSeparator();let u=l.filter(p=>a[p].enabled===!1);r.addItem(p=>p.setTitle("Enable all plugins in group").setDisabled(!l.length||!u.length).onClick(async()=>{u&&(await Promise.all(u.map(async d=>{se(n,d),a[d].enabled=!0,n.plugin.saveSettings()})),i.getLength(),new v.Notice("All plugins enabled.",2500),await m(n))}));let c=l.filter(p=>a[p].enabled===!0);r.addItem(p=>p.setTitle("Disable all plugins in group").setDisabled(!l.length||!c.length).onClick(async()=>{c&&(await Promise.all(c.map(async d=>{n.app.plugins.disablePluginAndSave(d),a[d].enabled=!1})),i.getLength(),new v.Notice("All plugins disabled.",2500),await m(n))})),r.addSeparator(),Xe(n,r,e),r.showAtMouseEvent(s)},dn=async(s,n,e)=>{let t=new v.Menu;if(t.addItem(i=>{i.setTitle("Install & enable in group"),i.onClick(async()=>{let o=G(n,e);o.length&&await ge(n,o,!0)})}),t.addItem(i=>{i.setTitle("Install plugins in group"),i.onClick(async()=>{let o=G(n,e);o.length&&await ge(n,o)})}),t.addItem(i=>{i.setTitle("Uninstall plugins in group"),i.onClick(async()=>{await gn(n,e)})}),n.app.isMobile){t.addSeparator();let i=G(n,e);t.addItem(o=>o.setTitle("Show/hide group content").onClick(async()=>{await me(n,e,i)}))}t.addSeparator(),Xe(n,t,e),t.showAtMouseEvent(s)},mt=async(s,n,e,t)=>{n instanceof P&&t?pn(s,n,e,t):await dn(s,n,e)};async function gn(s,n){let e=G(s,n);if(!e.length)return;let{plugin:t}=s,{settings:i}=t,{commPlugins:o}=i;for(let a of e)if(A(a))try{await this.app.plugins.uninstallPlugin(a),new v.Notice(`${o[a].name} uninstalled`,5e3)}catch(l){new v.Notice(`Failed to uninstall ${o[a].name}: ${l.message}`,5e3)}await m(s)}async function ge(s,n,e=!1){let{plugin:t}=s,{settings:i}=t,{commPlugins:o}=i;for(let a of n){if(A(a)){new v.Notice(`${o[a].name} already installed`,5e3);continue}let l=await V(s,a);if(!l)continue;let r=l.version;await this.app.plugins.installPlugin(o[a].repo,r,l),e&&(await s.app.plugins.enablePluginAndSave(a),new v.Notice(`${o[a].name} enabled`,5e3))}await m(s)}var G=(s,n)=>{let{plugin:e}=s,{settings:t}=e,{installed:i,commPlugins:o}=t;return s instanceof P?Object.keys(i).filter(a=>i[a].groupInfo.groupIndices.indexOf(n)!==-1):Object.keys(o).filter(a=>o[a].groupCommInfo.groupIndices.indexOf(n)!==-1)},ke=(s,n,e)=>{var a,l,r,u;let{plugin:t}=s,{settings:i}=t,o=Object.keys(n);for(let c=1;c<o.length;c++){let p=o[c];delete n[p]}for(let c=1;c<=e;c++)if(s instanceof O){i.groupsComm[c]||(i.groupsComm[c]={name:"",hidden:!1});let p=(a=i.groupsComm[c])!=null&&a.name?(l=i.groupsComm[c])==null?void 0:l.name:`Group${c}`;n[`Group${c}`]=`${p}`}else{i.groups[c]||(i.groups[c]={name:"",delayed:!1,time:0,applied:!1,hidden:!1});let p=(r=i.groups[c])!=null&&r.name?(u=i.groups[c])==null?void 0:u.name:`Group${c}`;n[`Group${c}`]=`${p}`}};function ve(s,n,e,t){let{plugin:i}=s,{settings:o}=i;Object.keys(L).forEach(a=>{var d,g;let{lengthGroup:l,groupIndex:r,groupValue:u}=bt(s,a),c=s instanceof P,p=c?((d=e.groupInfo)==null?void 0:d.groupIndices.indexOf(r))!==-1:((g=e.groupCommInfo)==null?void 0:g.groupIndices.indexOf(r))!==-1;if(a!=="SelectGroup"&&l&&p){let f=t?`remove ${u}`:`${u}`;n.addItem(b=>{b.setTitle(f).onClick(async()=>{var w,S;let M=c?(w=e.groupInfo)==null?void 0:w.groupIndices:(S=e.groupCommInfo)==null?void 0:S.groupIndices;ne(M,r),Te(r,s)&&(o.selectedGroup="SelectGroup"),await m(s)})})}})}var bt=(s,n)=>{let e=$(n),{settings:t}=s.plugin,{installed:i,commPlugins:o}=t,{lengthGroup:a,groupValue:l}=s instanceof P?{lengthGroup:Object.keys(i).filter(r=>i[r].groupInfo.groupIndices.indexOf(e)!==-1).length,groupValue:L[n]}:{lengthGroup:Object.keys(o).filter(r=>o[r].groupCommInfo.groupIndices.indexOf(e)!==-1).length,groupValue:U[n]};return{groupIndex:e,lengthGroup:a,groupValue:l}};function Ze(s,n,e){let{plugin:t}=s,{settings:i}=t,{installed:o,commPlugins:a,groups:l,groupsComm:r}=i,u;s instanceof P?u=ht(L,e):u=ht(U,e);let{lengthGroup:c,groupValue:p}=bt(s,u);u!=="SelectGroup"&&c&&n.addItem(d=>{d.setTitle(`${p}`).onClick(async()=>{let g=!1;if(s instanceof P)for(let f in o){let b=o[f].groupInfo.groupIndices.indexOf(e);b!==-1&&(l[e].hidden&&(l[e].hidden=!1,o[f].groupInfo.hidden=!1),o[f].groupInfo.groupIndices.splice(b,1),g=!0)}else for(let f in a){let b=a[f].groupCommInfo.groupIndices.indexOf(e);b!==-1&&(r[e].hidden&&(r[e].hidden=!1,a[f].groupCommInfo.hidden=!1),a[f].groupCommInfo.groupIndices.splice(b,1),g=!0)}await m(s),g?new v.Notice(`All plugins removed from ${p}`,2500):new v.Notice(`No plugins found in ${p} group`,2500)})})}var xe=(s,n,e,t)=>{Object.entries(L).forEach(([i,o])=>{let a=e instanceof P?n.groupInfo.groupIndices:n.groupCommInfo.groupIndices,l=$(i);if(i!=="SelectGroup"){t&&(o=`add to ${o}`);let{groups:r,installed:u}=e.plugin.settings;(v.Platform.isDesktop||v.Platform.isMobile&&a.indexOf(l)===-1)&&s.addItem(c=>c.setTitle(o).setDisabled(a.indexOf(l)!==-1).onClick(async()=>{a.length!==6&&(a==null||a.push(l),r[l].hidden&&(u[n.id].groupInfo.hidden=!0),await m(e))}))}})},wt=(s,n,e)=>{var u,c;let{plugin:t}=s,{settings:i}=t,o=(s instanceof O?((u=i.groupsComm[e])==null?void 0:u.name)||"":(c=i.groups[e])==null?void 0:c.name)||"",a=p=>{var d;s instanceof O?(i.groupsComm[e].name=p||U[e],n.textContent=i.groupsComm[e].name):(i.groups[e].name=p||L[e],n.textContent=(d=i.groups[e])==null?void 0:d.name)},l=()=>{setTimeout(async()=>{!s.isDblClick&&r&&(a(r.value),await m(s))},100)},r=he(n,o);r&&(r.onblur=l,r.onkeydown=p=>{p.key==="Enter"&&l()})},F=s=>{let n=["\u{1F7E1}","\u{1F535}","\u{1F534}","\u26AA\uFE0F","\u{1F7E3}","\u{1F7E2}"],e=["#FFD700","#0000FF","#FF0000","#FFFFFF","#800080","#00FF00"];return{emoji:n[s-1],color:e[s-1]}},T=s=>{let n=s.length,e="";if(n===1){let{color:i}=F(s[n-1]);e=`background: ${i};`}else if(n===2){let{color:i}=F(s[n-2]),{color:o}=F(s[n-1]);e=`background: linear-gradient(90deg, ${i} 50%, ${o} 50%);`}return`<div
            style="${e}"
            class="qps-item-line-group"
            >
            &nbsp;
            </div>
            `};function Te(s,n){let{plugin:e}=n,{settings:t}=e,{installed:i,commPlugins:o}=t;return n instanceof P?!Object.keys(i).some(a=>i[a].groupInfo.groupIndices.indexOf(s)!==-1):!Object.keys(o).some(a=>o[a].groupCommInfo.groupIndices.indexOf(s)!==-1)}function ht(s,n){for(let e in s)if(e.endsWith(n.toString()))return e;return null}function $(s){return s==="SelectGroup"?0:parseInt(s.slice(-1))}async function N(s,n){let{plugin:e}=s;"repo"in n?(n.groupCommInfo.groupIndices=[],e.settings.selectedGroupComm="SelectGroup"):(n.groupInfo.groupIndices=[],e.settings.selectedGroup="SelectGroup"),await m(s)}function Ie(s){var e,t;let n=s.nextElementSibling;return parseInt((t=(e=n==null?void 0:n.querySelector("span"))==null?void 0:e.textContent)!=null?t:"")}function fe(s){var n;return parseInt((n=s==null?void 0:s.slice(0,1))!=null?n:"0")}var yt=async s=>{let{plugin:n}=s;await W("Reset most switched values?",250)?(n.reset=!0,n.getLength(),await m(s),new _.Notice("Done",2500)):new _.Notice("Operation cancelled",2500)};var Ct=async(s,n)=>{let{plugin:e}=s;n.enabled=!n.enabled,n.enabled?await se(s,n.id):await s.app.plugins.disablePluginAndSave(n.id),e.getLength(),await m(s)};async function De(s,n){let e=window.electron.remote.shell,t=s.app.vault.adapter.getFullPath(n.dir);try{await e.openPath(t)}catch(i){let o=s.app.vault.adapter.getFullPath(".obsidian/plugins");await e.openPath(o)}}var Le=async(s,n)=>{let{plugin:e}=s,{settings:t}=e,{installed:i}=t;await s.app.plugins.disablePluginAndSave(n),await s.app.plugins.enablePlugin(n),i[n].enabled=!0},se=async(s,n)=>{let{installed:e}=s.plugin.settings;e[n].delayed&&e[n].time>0?(await s.app.plugins.enablePlugin(n),await s.plugin.saveSettings()):(e[n].switched++,await s.app.plugins.enablePluginAndSave(n))},fn=s=>{s==null||s.setSelectionRange(0,s==null?void 0:s.value.length)},Pt=(s,n,e)=>{let{settings:t}=n,{installed:i,filters:o}=t,a=(r,u)=>i[r].name.localeCompare(i[u].name);n.reset&&(e.forEach(r=>i[r].switched=0),n.reset=!1);let l={[E.enabledFirst]:()=>{let[r,u]=e.reduce((c,p)=>(c[i[p].enabled?0:1].push(p),c),[[],[]]);return[...r.sort(a),...u.sort(a)]},[E.byGroup]:()=>{let r=$(t.selectedGroup);return r!==0?e.filter(u=>i[u].groupInfo.groupIndices.includes(r)).sort(a):e.sort(a)},[E.mostSwitched]:()=>e.sort((r,u)=>i[u].switched-i[r].switched||a(r,u)),[E.hidden]:()=>ie(s,e),[E.all]:()=>e.sort(a)};return(l[o]||l[E.all])()};function he(s,n){if(s){let e=document.createElement("input");return e.type="text",e.value=n,s.replaceWith(e),e.focus(),fn(e),e}else return}var Oe=s=>{s.pressed=!0,setTimeout(()=>{s.pressed=!1},1)};function Z(){return Object.keys(this.app.plugins.manifests)}function ie(s,n){let{settings:e}=s.plugin,{installed:t,commPlugins:i}=e,o;return s instanceof P?o=n.filter(a=>t[a].groupInfo.hidden===!0):o=n.filter(a=>i[a].groupCommInfo.hidden===!0),n.filter(a=>o.includes(a))}function Mt(s,n){return n.filter(e=>s.plugin.settings.commPlugins[e].hasNote)}function A(s){return Z().includes(s)}async function m(s,n=!1){await s.plugin.saveSettings(),s.searchInit=n,await s.onOpen()}async function oe(s,n,e){var o;if(s.preventDefault(),!((o=n.plugin.settings.installed[e.id])==null?void 0:o.enabled)){new _.Notice("Plugin disabled, no Settings to show",3500);return}let i=n.app.setting.openTabById(e.id);if(!i){new _.Notice("No Settings on this plugin",2500);return}n.app.setting.open(),await(i==null?void 0:i.display())}var ae=async function(s,n,e){if(s.preventDefault(),!(n instanceof O?n.plugin.settings.installed[e.id].enabled:e.enabled)){new _.Notice("Plugin disabled, no HotKeys to show",3500);return}if(!await be(n,e)){new _.Notice("No HotKeys on this plugin",2500);return}await this.app.setting.open(),await this.app.setting.openTabById("hotkeys");let o=await this.app.setting.activeTab,a=e.name;n instanceof O&&(a=n.plugin.settings.installed[e.id].name),o.searchComponent.inputEl.value=a+":",o.updateHotkeyVisibility(),o.searchComponent.inputEl.blur()};function St(s,n){let e=`https://githubusercontent.com/${n.repo}/raw/HEAD/`;s=s.replace(/(?!href=\s*)(["'])(https?:\/\/[^"'\s]+)(["'])/g,(o,a,l,r)=>`${a}${l} ${r}`);let t=o=>o.startsWith("http")?o:o.startsWith(".")?`https://github.com/${n.repo}/raw/HEAD${o.substr(1)}`:`https://github.com/${n.repo}/raw/HEAD/${o}`,i=o=>{let a=l=>{let r=[new RegExp(`style=["'][^"']*${l}\\s*:\\s*(\\d+)(?:px|em|rem|%)?\\s*(!important)?["']`,"i"),new RegExp(`${l}\\s*=\\s*["']?(\\d+)(?:px|em|rem|%)?["']?(?:\\s|>)`,"i")];for(let u of r){let c=u.exec(o);if(c&&c[1])return parseInt(c[1],10)}return null};return{width:a("width"),height:a("height")}};return s=s.replace(/<img[^>]*src=["']?(\.?\/?[^"'\s]+)["']?[^>]*>/gi,(o,a)=>{let l=t(a.trim()),{width:r,height:u}=i(o),c=o.match(/alt=["']([^"']*)["']/i),p=c?c[1]:"Image";return r&&u?`![${p}|${r}x${u}](${l})`:r?`![${p}|${r}](${l})`:u?`![${p}|${u}](${l})`:`![${p}](${l})`}),s=s.replace(/(!?)\[(.*?)\]\(((?!http)(?!#)(?!\/).*?)\)/g,(o,a,l,r)=>`${a}[${l}](${e}${r})`),s=s.replace(/https:\/\/github\.com\/([^/]+)\/([^/]+)\/blob\/([^/]+)\/(.+?)\.(png|jpe?g|gif|svg|webp)/gi,(o,a,l,r,u,c)=>`https://raw.githubusercontent.com/${a}/${l}/${r}/${u}.${c}`),s}function K(s){return s.mousePosition?document.elementFromPoint(s.mousePosition.x,s.mousePosition.y):null}function le(s){setTimeout(()=>{var n;(n=document.querySelector(".qps-search-component input"))==null||n.focus()},s)}var j=Ye(require("path"));var X=require("obsidian");function hn(){return this.plugin.translator&&this.plugin.translator.valid}async function mn(s,n){let e="",t=this.app.plugins.plugins.translate;if(!t){new X.Notice("install obsidian-translate and select a translator");return}if(!hn){new X.Notice("translator not valid. check your settings",4e3);return}let i=await t.loadData();return i.target_language_preference==="last"?e=i.last_used_target_languages[0]:i.target_language_preference==="specific"?e=i.default_target_language:i.target_language_preference==="display"&&(e=t.current_language),t.translator.translate(s,n,e)}async function ee(s){if(!s){new X.Notice("no content selected",2e3);return}let n=await mn(s,"en");if(!n)return;let e=n.translation;if(!e){new X.Notice("translator not valid. check your settings",4e3);return}new et(this.app,e).open()}var et=class extends X.Modal{constructor(e,t){super(e);this.message=t;this.modalEl.addClass("translate-modal")}onOpen(){let{contentEl:e}=this;e.empty(),this.message.split(`
`).forEach(i=>e.createEl("p").setText(i))}onClose(){let{contentEl:e}=this;e.empty()}};var O=class extends C.Modal{constructor(e,t){super(e);this.plugin=t;this.searchTyping=!0;this.isDblClick=!1;this.pressed=!1;this.searchInit=!0;this.getMousePosition=e=>{this.mousePosition={x:e.clientX,y:e.clientY}};this.getHandleKeyDown=async e=>{await yn(e,this)};this.getHandleContextMenu=async e=>{this.isDblClick||await Qe(e,this)};this.getHandleDblClick=e=>{this.isDblClick||ye(e,this)};this.getHandleClick=e=>{this.isDblClick||we(e,this)};this.getHandleTouch=e=>{this.isDblClick||je(e,this)};this.addHeader=e=>{let{plugin:t}=this,{settings:i}=t;new C.DropdownComponent(e).addOptions({all:`All(${Object.keys(i.commPlugins).length})`,installed:`Installed(${Z().length})`,notInstalled:C.Platform.isMobile?"Not Installed":`Not Installed(${Object.keys(i.commPlugins).length-Z().length})`,byGroup:"By Group",hidden:`Hidden(${ie(this,Object.keys(i.commPlugins)).length})`,hasNote:`With Note(${Mt(this,Object.keys(i.commPlugins)).length})`}).setValue(i.filtersComm).onChange(async o=>{i.filtersComm=o,await t.saveSettings(),await m(this)}),Ee(this,e),Lt(this,e),Fe(this,e,"Inv")};this.plugin=t}removeListeners(){this.modalEl.removeEventListener("mousemove",this.getMousePosition),document.removeEventListener("keydown",this.getHandleKeyDown),this.modalEl.removeEventListener("contextmenu",this.getHandleContextMenu),C.Platform.isDesktop&&(this.modalEl.removeEventListener("dblclick",this.getHandleDblClick),this.modalEl.removeEventListener("click",this.getHandleClick)),C.Platform.isMobile&&this.modalEl.removeEventListener("touchstart",this.getHandleTouch)}container(){let{contentEl:e}=this;this.modalEl.addClass("community-plugins-modal"),this.header=e.createEl("div",{cls:"qps-community-header"}),this.search=e.createEl("div",{cls:"qps-community-search"}),this.groups=e.createEl("div",{cls:["qps-community-groups","qps-comm-group"]}),this.hotkeysDesc=e.createEl("p",{cls:"qps-hk-desc"}),this.items=e.createEl("div",{cls:"qps-community-items"}),this.modalEl.addEventListener("mousemove",this.getMousePosition),document.addEventListener("keydown",this.getHandleKeyDown),this.modalEl.addEventListener("contextmenu",this.getHandleContextMenu),C.Platform.isDesktop&&(this.modalEl.addEventListener("dblclick",this.getHandleDblClick),this.modalEl.addEventListener("click",this.getHandleClick)),C.Platform.isMobile&&this.modalEl.addEventListener("touchstart",this.getHandleTouch)}async onOpen(){this.removeListeners();let{plugin:e,contentEl:t}=this,{settings:i}=e;this.searchInit&&(i.search=""),this.searchInit=!0,t.empty(),this.container(),ke(this,U,i.numberOfGroupsComm),this.addHeader(this.header),await Ge(this,this.search,"Search community plugins"),C.Platform.isDesktopApp&&Ht(this,this.search),this.addGroups(this,this.groups),i.showHotKeys&&!this.app.isMobile&&this.setHotKeysdesc(),await this.addItems(i.search)}addGroups(e,t){let i=Object.values(U);for(let o=1;o<i.length;o++){let a=i[o];t.createEl("span",{cls:"qps-group-span-container"},l=>{l.createEl("span",{cls:"qps-circle-title-group"},c=>{it(this,c,o)});let r=l.createEl("span",{cls:"qps-groups-name",text:`${a}`},c=>{var f;let{plugin:p}=e,{settings:d}=p;((f=d.groupsComm[o])==null?void 0:f.hidden)?(c.style.textDecoration="line-through",c.style.opacity="0.6"):c.style.textDecoration="none"}),u=`<span class="shortcut-number">${o}:</span>`;r.insertAdjacentHTML("afterbegin",u)})}this.app.isMobile?t.createSpan({text:"(\u{1F5B1}\uFE0Fx2)name,icon:delay (\u{1F5B1}\uFE0F...)context-menu"}):t.createSpan({text:"> (h)\u{1F441}\uFE0F (\u{1F5B1}\uFE0Fx2)name"})}setHotKeysdesc(){let e=this.plugin.settings.numberOfGroupsComm;this.hotkeysDesc.createSpan({text:`(1-${e})\u2795 (0)\u274C `},t=>{t.createSpan({text:"(g)"},i=>{let o=i.createSpan({cls:"git-hub-icon"});(0,C.setIcon)(o,"github")}),t.createSpan({text:" (\u{1F5B1}\uFE0Fx2/ctrl)Readme "}),t.createSpan({text:"(n)\u{1F4DD} "}),t.createSpan({text:"(s)\u{1F4CA} "}),t.createSpan({text:"(t)translate"})})}async addItems(e){let{plugin:t}=this,{settings:i}=t,{commPlugins:o,pluginStats:a}=i,l=Dt(e,o);l=wn(this,l),bn.bind(this)(this,l),await this.drawItemsAsync.bind(this)(l,a,e)}hightLightSpan(e,t){if(e.trim()==="")return t;{let i=(0,C.prepareSimpleSearch)(e)(t),o=(i==null?void 0:i.matches)||[];if(!o.length)return t;let a=t;return o.forEach(([l,r])=>{let u=t.slice(l,r),c=`<span class="highlighted">${u}</span>`;a=a.replace(u,c)}),a}}async drawItemsAsync(e,t,i){let a=0,{plugin:l}=this,{settings:r}=l,{commPlugins:u,filtersComm:c}=r;for(;a<e.length;){let d=e.slice(a,a+50).map(async g=>{var pe,de;if((pe=u[g].groupCommInfo)!=null&&pe.hidden&&!u[g].groupCommInfo.groupIndices.length&&(u[g].groupCommInfo.hidden=!1),c!==D.byGroup&&(de=u[g].groupCommInfo)!=null&&de.hidden&&c==="all")return;let f=this.items.createEl("div",{cls:"qps-comm-block"});f.setAttribute("data-plugin-id",g),this.app.isMobile&&f.createEl("div",{cls:"button-container"},I=>{$e(I)});let b=f.createEl("div",{cls:"button-container1"},I=>{Ot(I,this,u[g])});C.Platform.isDesktop&&b.addClass("button-container1-desktop"),u[g].hasNote&&b.addClass("notes-button-background");let M=this.hightLightSpan(i,u[g].name),w=`by ${this.hightLightSpan(i,u[g].author)}`,S=this.hightLightSpan(i,u[g].description);f.createDiv({cls:"qps-community-item-name"},I=>{if(I.innerHTML=M,A(g)&&I.createSpan({cls:"installed-span",text:"installed"}),x(this,g)){let Me=I.createSpan({cls:"enabled-span"});(0,C.setIcon)(Me,"power")}}),f.createDiv({cls:"qps-community-item-author"},I=>{I.innerHTML=w});let B=t[g];f.createDiv({cls:"qps-community-item-downloads"},I=>{I.createSpan({cls:"downloads-span"},Me=>{let _t=Me.createSpan(),Zt=B?rt(B.downloads,1).toString():"0",Xt=Me.createSpan({text:Zt,cls:"downloads-text-span"});Pn(this,Xt,g),(0,C.setIcon)(_t,"download-cloud")})});let te=B?new Date(B.updated):null,ue=te?ct(te):"";return f.createDiv({cls:"qps-community-item-updated",text:te?`Updated ${ue}`:"Updated: not available yet"}),f.createDiv({cls:"qps-community-item-desc"},I=>{I.innerHTML=S}),f});await Promise.all(d),a+=50}}async onClose(){let{contentEl:e}=this;e.empty(),this.removeListeners(),await this.plugin.installedUpdate(),new P(this.app,this.plugin).open(),le(100)}};async function He(s,n){try{let e=await(0,C.requestUrl)(s);if(e.status!==200)throw new Error(`HTTP error! status: ${e.status}`);return e.json}catch(e){return console.warn(n||`Error fetching data from ${s}:`,e),null}}async function vt(s){let n=s.repo,e=["README.md","README.org"];for(let t of e){let i=`https://api.github.com/repos/${n}/contents/${t}`;try{let o=await(0,C.requestUrl)(i);if(o.status===200)return o.json}catch(o){}}return console.warn(`No README found for ${n}`),null}async function V(s,n){var o;let{commPlugins:e}=s.plugin.settings,i=`https://raw.githubusercontent.com/${(o=e[n])==null?void 0:o.repo}/HEAD/manifest.json`;return He(i,`Error fetching manifest for ${n}:`)}async function xt(s,n,e){let{commPlugins:t}=s.plugin.settings,o=`https://github.com/${t[n].repo}/releases/tag/${e.version}`;try{return!!await(0,C.requestUrl)(o)}catch(a){return!1}}function bn(s,n){let{settings:e}=s.plugin,{commPlugins:t}=e,{sortBy:i}=e,o={Downloads:()=>n.sort((a,l)=>e.invertFiltersComm?t[a].downloads-t[l].downloads:t[l].downloads-t[a].downloads),Updated:()=>n.sort((a,l)=>e.invertFiltersComm?t[a].updated-t[l].updated:t[l].updated-t[a].updated),Alpha:()=>n.sort((a,l)=>e.invertFiltersComm?t[l].name.localeCompare(t[a].name):t[a].name.localeCompare(t[l].name)),Released:()=>n.sort((a,l)=>{let r=e.plugins.findIndex(c=>c===t[a].id),u=e.plugins.findIndex(c=>c===t[l].id);return e.invertFiltersComm?r-u:u-r})};return(o[i]||o.Downloads)()}function wn(s,n){let{settings:e}=s.plugin,{filtersComm:t,commPlugins:i}=e,o={[D.installed]:()=>{let a=Z();return n.filter(l=>a.includes(l))},[D.notInstalled]:()=>{let a=Z();return n.filter(l=>!a.includes(l))},[D.hasNote]:()=>n.filter(a=>i[a].hasNote),[D.byGroup]:()=>{let a=$(e.selectedGroup);return a!==0?n.filter(l=>{var r;return((r=i[l].groupCommInfo)==null?void 0:r.groupIndices.indexOf(a))!==-1}):n},[D.hidden]:()=>ie(s,n),[D.all]:()=>n};return(o[t]||o[D.all])()}var yn=async(s,n)=>{var a;let e=K(n),t=e==null?void 0:e.closest(".qps-comm-block"),i=e==null?void 0:e.closest(".qps-circle-title-group"),o=e==null?void 0:e.closest(".qps-groups-name");if(t){(a=document.querySelector(".qps-search-component input"))==null||a.blur(),n.searchTyping=!1;let l=R(n,t);l&&(s.preventDefault(),await Cn(n,s,l))}else(i||o)&&s.key==="h"?(n.searchTyping=!1,await ot(n,i,o)):n.searchTyping=!0},Cn=async(s,n,e)=>{if(s.pressed)return;Oe(s);let{plugin:t}=s,{settings:i}=t,{groupsComm:o,commPlugins:a}=i,l=i.numberOfGroupsComm,r={g:async()=>await Q(n,s,e),n:async()=>await re(n,s,e),s:async()=>st(e),t:async()=>{var g;let d=(g=z())!=null?g:"";await ee(d)}},u=n.key,c=e.groupCommInfo.groupIndices,p=parseInt(u);if(p>0&&p<=l){if(c.length===6)return;c.indexOf(p)===-1&&(c.push(p),o[p].hidden&&(a[e.id].groupCommInfo.hidden=!0),await m(s))}else if(u in r)r[u]();else if(n.metaKey||n.ctrlKey)new Y(t.app,s,e).open();else if(u==="Delete"||u==="Backspace"||u==="0"){if(c.length===1)e.groupCommInfo.groupIndices=[],await t.saveSettings(),await m(s);else if(c.length>1){let d=new C.Menu;d.addItem(g=>g.setTitle("Remove item group(s)").setDisabled(!0).setDisabled(!0)),d.addSeparator(),d.addItem(g=>g.setTitle("All").onClick(async()=>{await N(s,e)}));for(let g of c){let{emoji:f}=F(g);d.addItem(b=>b.setTitle(`${f} group ${g}`).onClick(async()=>{c=ne(c,g),await t.saveSettings(),await m(s)}))}d.showAtPosition(s.mousePosition)}}},Pn=(s,n,e)=>{let{settings:t}=s.plugin,{commPlugins:i}=t,o=i[e].groupCommInfo.groupIndices;if(o.length){if(o.length<3){let a=T(o);n.insertAdjacentHTML("afterend",a)}if(o.length>=3&&o.length<5){let[a,l,...r]=o,c=T([a,l]);n.insertAdjacentHTML("afterend",c);let p=T(r);n.insertAdjacentHTML("afterend",p)}else if(o.length>=5){let[a,l,r,u,...c]=o,p=[a,l],d=[r,u],g=T(p);n.insertAdjacentHTML("afterend",g);let f=T(d);n.insertAdjacentHTML("afterend",f);let b=T(c);n.insertAdjacentHTML("afterend",b)}}};async function tt(s,n=!1){let e=await Mn();if(e){let t=Object.keys(s.plugin.settings.commPlugins).filter(i=>e.includes(i));await ge(s,t,n)}}async function Mn(){let s=["openFile"],n=window.electron.remote.dialog.showOpenDialogSync({title:"Pick json list file of plugins to install",properties:s,filters:[{name:"JsonList",extensions:["json"]}]});if(n&&n.length)try{let e=(0,H.readFileSync)(n[0],"utf-8"),t=JSON.parse(e);if(Array.isArray(t))return t;console.error("this file is not a JSON list."),new C.Notice("Error: The selected file is not a valid JSON list.",3e3)}catch(e){console.error("Error reading JSON file: ",e),new C.Notice("Error: Could not read the selected JSON file.",3e3)}return null}async function Tt(s,n=!1){let e=Z(),t=window.electron.remote.dialog.showSaveDialogSync({title:"Save installed plugins list as JSON",filters:[{name:"JSON Files",extensions:["json"]}]});if(t&&t.length)try{let i=JSON.stringify(e,null,2);(0,H.writeFileSync)(t,i),new C.Notice(`${t} created`,2500)}catch(i){console.error("Error saving JSON file:",i)}}async function nt(s,n=!1){let e=window.electron.remote.dialog.showOpenDialogSync({title:"Select your vault directory, you want plugins list from",properties:["openDirectory"]});if(e&&e.length){let t=e[0],i=j.join(t,".obsidian");if(!(0,H.existsSync)(i)){new C.Notice("Select a vault folder!",2500);return}let o=j.basename(t),a=s.app.vault.getName();if(o===a){new C.Notice("You have selected the current vault!",2500);return}let l=j.join(i,"plugins");if(!(0,H.existsSync)(l)){new C.Notice("This vault doesn't contain any installed plugin!",2500);return}let r=[],u=(0,H.readdirSync)(l);for(let p of u){let d=j.join(l,p),g=j.join(d,"package.json"),f=j.join(d,"manifest.json"),b=j.join(d,"main.js");if(!(0,H.existsSync)(g)&&(0,H.existsSync)(f)&&(0,H.existsSync)(b)){let M=(0,H.readFileSync)(f,"utf-8"),S=JSON.parse(M).id;r.push(S)}}if(!r.length){new C.Notice("Found no plugin to install",2500);return}let c=Object.keys(s.plugin.settings.commPlugins).filter(p=>r.includes(p));await ge(s,c,n)}}async function It(s){let n="Community plugins notes",e=s.settings.commPluginsNotesFolder,t=e?e+"/"+n+".md":n+".md",i=this.app.vault.getAbstractFileByPath(t),{commPlugins:o}=s.settings;if(i){let l=(await this.app.vault.read(i)).split(`
`).filter(r=>r.startsWith("# ")).map(r=>r.substring(2).trim());for(let r of Object.values(o))r.hasNote=l.includes(r.name)}else for(let a of Object.values(o))a.hasNote=!1}async function re(s,n,e,t){let i="Community plugins notes",o=n.plugin.settings.commPluginsNotesFolder,a;o&&!n.app.vault.getAbstractFileByPath(o)&&await n.app.vault.createFolder(o);let l=o?o+"/"+i+".md":i+".md";a=n.app.vault.getFileByPath(l),a||(await n.app.vault.create(l,""),a=n.app.vault.getFileByPath(l));let r=a?await n.app.vault.read(a):"",u="# "+e.name,c=r.indexOf(u),p="";if(c!==-1){let d=r.substring(c),g=d.indexOf(`
# `,u.length);p=g!==-1?d.substring(0,g):d,p=p.replace(u+`

`,"")}else{r&&!r.endsWith(`
`)&&(r=r+`
`);let d=r?r+`
`+u+`

`:u+`

`;await n.app.vault.modify(a,d),r=await n.app.vault.read(a),p=""}new Ae(n.app,n,e,p,async d=>{await Sn(d,n,e,p,a,r,t)},t).open()}async function Sn(s,n,e,t,i,o,a){if(s===null){let l=o.replace(t,"");await n.app.vault.modify(i,l);return}if(s.trim()===""){let l=new RegExp(`# ${e.name}

?${En(t)}
?`,"g"),r=o.replace(l,"");await n.app.vault.modify(i,r),await Et(n,e,!1),kt(n,a);return}if(t.trim()!==s.trim()){if(!t)await n.app.vault.append(i,s);else{let l=o.replace(t,s);await n.app.vault.modify(i,l)}await Et(n,e,!0),kt(n,a)}}async function Et(s,n,e){n.hasNote=e,await s.plugin.saveSettings()}function kt(s,n){n&&n.onOpen(),s.searchInit=!1,s.onOpen()}function En(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var ce=class extends y.Modal{constructor(e,t,i){super(e);this.plugin=t;this.pluginItem=i;this.plugin=t,this.pluginItem=i}onOpen(){let{contentEl:e,pluginItem:t}=this;e.empty(),e.createEl("p",{text:t.name+" - v"+t.version}).createEl("p",{text:"author: "+t.author+", url: "+(t.authorUrl?"":"null")}).createEl("a",{text:t.authorUrl,href:t.authorUrl});let i;Object.values(this.plugin.settings.commPlugins).forEach(o=>{o.id===t.id&&(i=o.description)}),i=i||t.description,e.createEl("p",{text:i})}onClose(){let{contentEl:e}=this;e.empty()}},at=class extends y.Modal{constructor(e,t,i,o,a){super(e);this.message=t;this.callback=i;this.width=o;this.height=a}onOpen(){let{contentEl:e}=this;e.empty(),this.width&&(this.modalEl.style.width=`${this.width}px`),this.height&&(this.modalEl.style.height=`${this.height}px`),e.createEl("p").setText(this.message),new y.Setting(this.contentEl).addButton(t=>{t.setIcon("checkmark").setCta().onClick(()=>{this.callback(!0),this.close()})}).addExtraButton(t=>t.setIcon("cross").onClick(()=>{this.callback(!1),this.close()}))}onClose(){let{contentEl:e}=this;e.empty()}};async function kn(s,n,e,t){return await new Promise(i=>{new at(s,n,o=>{i(o)},e!=null?e:void 0,t!=null?t:void 0).open()})}async function W(s,n,e){return await kn(this.app,s,n!=null?n:void 0,e!=null?e:void 0)}var Y=class extends y.Modal{constructor(e,t,i){super(e);this.modal=t;this.pluginItem=i;this.scope=new y.Scope(this.app.scope);this.modal=t,this.pluginItem=i,this.modalEl.addClass("read-me-modal"),this.comp=new y.Component,this.comp.load()}async onOpen(){let{contentEl:e,pluginItem:t}=this;e.empty();let i=t.id;e.createEl("p",{text:t.name,cls:"readme-title"}).createEl("p",{text:"By: "+t.author});let o=e.createDiv();new y.ButtonComponent(o).setButtonText("GitHub Repo").onClick(async f=>{await Q(f,this.modal,t)});let a=e.createDiv({cls:"read-me-buttons"});if(!A(i))new y.ButtonComponent(a).setButtonText("Install").setCta().onClick(async()=>{let f=await V(this.modal,i);if(!f){new y.Notice(`Manifest ${i} not found`,2500);return}let b=f.version;await this.app.plugins.installPlugin(t.repo,b!=null?b:"",f),new y.Notice(`${t.name} installed`,2500),await this.onOpen(),await m(this.modal)});else{let f=this.app.plugins.manifests||{},b;x(this.modal,f[t.id].id)?(this.modal.app.setting.openTabById(t.id)&&new y.ButtonComponent(a).setButtonText("Options").onClick(async w=>{await oe(w,this.modal,t)}),b=await be(this.modal,t),b&&new y.ButtonComponent(a).setButtonText("Hotkeys").onClick(async w=>{await ae(w,this.modal,t)}),i!=="quick-plugin-switcher"&&new y.ButtonComponent(a).setButtonText("Disable").onClick(async()=>{await this.modal.app.plugins.disablePluginAndSave(t.id),await this.onOpen(),new y.Notice(`${t.name} disabled`,2500),await m(this.modal)})):new y.ButtonComponent(a).setButtonText("Enable").onClick(async()=>{await this.modal.app.plugins.enablePluginAndSave(t.id),await this.onOpen(),this.modal.plugin.installedUpdate(),new y.Notice(`${t.name} enabled`,2500),await m(this.modal)}),i!=="quick-plugin-switcher"&&new y.ButtonComponent(a).setButtonText("Uninstall").onClick(async()=>{try{await this.modal.app.plugins.uninstallPlugin(t.id),await this.onOpen(),new y.Notice(`${t.name} uninstalled`,2500),await m(this.modal)}catch(M){new y.Notice(`Failed to uninstall ${t.name}: ${M.message}`,5e3)}})}let l=e.createDiv({cls:"read-me-shortcuts"}),r=l.createDiv({cls:"notes-button-container"});new y.ButtonComponent(r).setButtonText("\u{1F4DD}").onClick(async f=>{await re(f,this.modal,t,this)}),t.hasNote&&r.addClass("notes-button-background"),y.Platform.isDesktop&&l.createSpan({text:" (t) translate  (n) add note  (g) gitHub repo"});let u=e.createDiv({cls:"qps-read-me"}),c=await vt(t);if(!c)return;let d=new TextDecoder("utf-8").decode(pt(c.content)),g=St(d,t);await y.MarkdownRenderer.render(this.app,g,u,"/",this.comp),this.modalEl.addEventListener("mousemove",f=>{this.mousePosition={x:f.clientX,y:f.clientY}}),this.scope.register([],"t",async()=>{let f=z();if(!f){new y.Notice("no selection",4e3);return}await ee(f)}),this.scope.register([],"n",async f=>await re(f,this.modal,t)),this.scope.register([],"g",async f=>await Q(f,this.modal,t)),this.scope.register([],"escape",async f=>{this.close()}),this.modalEl.addEventListener("contextmenu",f=>{f.preventDefault();let b=z();if(b){let M=new y.Menu;M.addItem(w=>w.setTitle("Copy (Ctrl+C)").onClick(async()=>{await navigator.clipboard.writeText(b)})),M.addItem(w=>w.setTitle("translate (t)").onClick(async()=>{await ee(b)})),M.showAtPosition(this.mousePosition)}})}onClose(){let{contentEl:e}=this;e.empty(),this.comp.unload()}},Ae=class extends y.Modal{constructor(e,t,i,o,a,l){super(e);this.modal=t;this.pluginItem=i;this.sectionContent=o;this.cb=a;this._this=l}onOpen(){let{contentEl:e}=this;e.createEl("h6",{text:"Don't include H1 titles. To delete a note delete all content. Saved on close.",cls:"read-me-shortcuts "}),e.createEl("h3",{text:this.pluginItem.name+" by "+this.pluginItem.author}),new y.Setting(e).addTextArea(t=>{var i;t.setValue((i=this.sectionContent)!=null?i:""),t.inputEl.rows=40,t.inputEl.cols=82,t.inputEl.onblur=async()=>{this.sectionContent=t.getValue();let o=this.sectionContent.split(`
`),a=!1;for(let l of o)if(l.startsWith("# ")){new y.Notice("H1 are not allowed, content was paste in clipboard",4e3),navigator.clipboard.writeText(this.sectionContent),await this.cb(null),a=!0;break}this.onClose(),!a&&(this.sectionContent&&!this.sectionContent.endsWith(`
`)&&(this.sectionContent=this.sectionContent+`
`),this.sectionContent,await this.cb(this.sectionContent))}})}};var h=require("obsidian");var Be=Ye(require("path")),Ue=require("fs"),Bt=Ye(Gt());var Ut=(s,n)=>{let{settings:e}=s.plugin,{filters:t,installed:i}=e;t===E.mostSwitched&&Object.keys(i).some(o=>i[o].switched!==0)&&new h.ExtraButtonComponent(n).setIcon("reset").setTooltip("Reset mostSwitched values").onClick(async()=>{yt(s),await m(s)})};async function Ge(s,n,e){let{plugin:t}=s,{settings:i}=t;new h.Setting(n).addSearch(async o=>{o.setValue(i.search).setPlaceholder(e).onChange((0,h.debounce)(async a=>{s.searchTyping&&(i.search=a,s.items.empty(),s.addItems(a))},20))}).setClass("qps-search-component")}function Nt(s,n,e){let{byAuthor:t}=s.plugin.settings,i=(0,h.prepareSimpleSearch)(n);return Object.keys(e).filter(o=>{var c;if(n.trim()==="")return!0;let{name:a,author:l}=e[o],r=t?[a,l]:[a],u=!1;for(let p of r)(c=i(p))!=null&&c.matches.length&&(u=!0);return u})}function Dt(s,n){let e=(0,h.prepareSimpleSearch)(s);return Object.keys(n).filter(t=>{var u;if(s.trim()==="")return!0;let{name:i,author:o,description:a}=n[t],l=[i,o,a],r=!1;for(let c of l)(u=e(c))!=null&&u.matches.length&&(r=!0);return r})}var Lt=(s,n)=>{let{plugin:e}=s,{settings:t}=e;new h.ButtonComponent(n).setIcon("arrow-up-narrow-wide").setClass("comm-button").setTooltip("change type of sorting").buttonEl.addEventListener("click",async i=>{let o=new h.Menu;for(let a in Je)o.addItem(l=>l.setTitle(Je[a]).onClick(async()=>{t.sortBy=a,await m(s)}).setChecked(a===t.sortBy));o.showAtMouseEvent(i)})},vn=(s,n)=>{let{plugin:e}=s,t=new h.ButtonComponent(n).setIcon("rocket").setCta(),i=Object.values(s.plugin.settings.installed).filter(o=>o.toUpdate);i.length&&t.setClass("red"),t.setClass("update-button").setTooltip("Search for updates").buttonEl.addEventListener("click",async o=>{if(i.length){let a=new h.Menu;a.addItem(l=>l.setTitle("Update plugin(s)").setIcon("book-copy").onClick(async()=>{await Promise.allSettled(i.map(async r=>{r.toUpdate=!1,await Jt(s,r,e.settings.commPlugins)}))})),a.addItem(l=>l.setTitle("Search for updates again").setIcon("rocket").onClick(async()=>{Ft(s)})),a.showAtMouseEvent(o)}else Ft(s)})},Fe=(s,n,e)=>{let{plugin:t}=s,{settings:i}=t;if(s instanceof P&&i.filters===E.byGroup)return;let o=s instanceof P;n.createDiv({text:e,cls:"qps-comm-invert"},a=>{a.createEl("input",{attr:{cls:"qps-invert-button",type:"checkbox",checked:o?i.byAuthor:i.invertFiltersComm}},l=>{l.checked=o?i.byAuthor:i.invertFiltersComm,l.onchange=()=>{o?i.byAuthor=l.checked:i.invertFiltersComm=l.checked,t.saveSettings(),m(s)}})})};async function Ft(s){let{installed:n}=s.plugin.settings,e=!1,t=0;for(let i of Object.values(n)){if(!i.dir)continue;let o=s.app.vault.adapter.getFullPath(i.dir);if(!o)continue;if(h.Platform.isDesktop){let r=Be.join(o,"package.json");if((0,Ue.existsSync)(r))continue}let a=await V(s,i.id);if(!a)continue;let l=a.version;!l||l<=i.version?(i.toUpdate=!1,l&&l<=i.version&&(e=!0)):l>i.version&&(t+=1,e=!0,i.toUpdate=!0)}e?(new h.Notice(`${t} plugins to update`,3e3),await m(s)):new h.Notice("All plugins are up to date")}var $e=s=>{new h.ButtonComponent(s).setButtonText("\u2807").setTooltip("open context-menu")},Ot=(s,n,e)=>{new h.ButtonComponent(s).setTooltip("open plugin notes").setButtonText("\u{1F4DD}")},xn=(s,n)=>{let{plugin:e}=s;new h.ButtonComponent(n).setIcon("download-cloud").setCta().setClass("comm-button").setTooltip("community plugins: you can tag plugins with groups, install by group...").buttonEl.addEventListener("click",async t=>{await e.exeAfterDelay(e.pluginsCommInfo.bind(e)),s.close(),new O(s.app,e).open(),le(10)})},Tn=(s,n)=>{new h.ButtonComponent(n).setIcon("list-end").setCta().setTooltip("Install & enable plugins based on another Vault content or from a JSON list").buttonEl.addEventListener("click",e=>{let t=new h.Menu;t.addItem(i=>i.setTitle("Install plugins based on another Vault").setIcon("book-copy").onClick(async()=>{await nt(s)})),t.addItem(i=>i.setTitle("Install & enable plugins based on another Vault").setIcon("book-copy").onClick(async()=>{await nt(s,!0)})),t.addSeparator(),t.addItem(i=>i.setTitle("Save installed plugins list").setIcon("pen-square").onClick(async()=>{await Tt(s,!0)})),t.addItem(i=>i.setTitle("Install & enable plugins from json list").setIcon("list").onClick(async()=>{await tt(s,!0)})),t.addItem(i=>i.setTitle("Install plugins from json list").setIcon("list").onClick(async()=>{await tt(s)})),t.showAtMouseEvent(e)})},In=(s,n)=>{let{plugin:e}=s,{settings:t}=e,{installed:i}=t;new h.ButtonComponent(n).setIcon("power").setCta().setTooltip("toggle plugins: you can disable some plugins and enable them later").buttonEl.addEventListener("click",o=>{let a=new h.Menu;e.lengthEnabled===1&&t.wasEnabled.length===0?a.addItem(l=>l.setTitle("No enabled plugins")):(a.addItem(l=>l.setTitle(t.wasEnabled.length>0?"Enable previous disabled plugins":"Disable all plugins").setIcon(t.wasEnabled.length>0?"power":"power-off").onClick(async()=>{if(e.lengthEnabled>1){for(let r in i)r!=="quick-plugin-switcher"&&(i[r].enabled&&t.wasEnabled.push(r),await s.app.plugins.disablePluginAndSave(r),i[r].enabled=!1);e.getLength(),await m(s),new h.Notice("All plugins disabled",2500)}else if(t.wasEnabled.length>0){for(let r of t.wasEnabled){let u=Object.keys(i).find(c=>c===r);u&&(await se(s,u),i[u].enabled=!0)}e.getLength(),await m(s),t.wasEnabled=[],new h.Notice("All plugins re-enabled",2500),await s.plugin.saveSettings()}})),t.wasEnabled.length>0&&a.addItem(l=>l.setTitle("Skip re-enable").setIcon("reset").onClick(async()=>{await W("reset to disable",300)?(t.wasEnabled=[],await s.plugin.saveSettings(),new h.Notice("Done",2500)):new h.Notice("Operation cancelled",2500)})),a.addSeparator(),a.addItem(l=>l.setTitle("Toggle enabled-plugins by group").setDisabled(!0)),Object.keys(L).forEach(l=>{if(l==="SelectGroup")return;let r=L[l],u=$(l),c=Object.keys(i).filter(d=>i[d].groupInfo.groupIndices.indexOf(u)!==-1),p=c.filter(d=>i[d].groupInfo.groupWasEnabled===!0);c.length>0&&(c.some(d=>i[d].enabled===!0)||p.length>0)&&(a.addItem(d=>d.setTitle(p.length>0?`Re-enable ${r}`:r).setIcon(p.length>0?"power":"power-off").onClick(async()=>{if(p.length===0){let g=c.filter(f=>i[f].enabled===!0).map(async f=>{i[f].groupInfo.groupWasEnabled=!0,await s.app.plugins.disablePluginAndSave(f),i[f].enabled=!1});await Promise.all(g),g&&(e.getLength(),await m(s),new h.Notice("All plugins disabled",2500))}else{for(let g of p)await se(s,g),i[g].enabled=!0,i[g].switched++;p.map(g=>{i[g].groupInfo.groupWasEnabled=!1}),e.getLength(),await m(s),new h.Notice("All plugins re-enabled",2500)}})),p.length>0&&a.addItem(d=>d.setTitle("Skip re-enable").setIcon("reset").onClick(async()=>{await W("skip re-enable ?",200)?(p.map(f=>{i[f].groupInfo.groupWasEnabled=!1}),await s.plugin.saveSettings(),new h.Notice("Done",2500)):new h.Notice("Operation cancelled",2500)})))})),a.showAtMouseEvent(o)})},Vt=(s,n,e)=>{n.target===0&&e.toggleClass("qps-is-desktop",!0),n.target===1&&e.toggleClass("qps-is-mobile",!0);let{settings:t}=s.plugin;n.id==="quick-plugin-switcher"&&e.toggleClass("qps-quick-plugin-switcher",!0),n.isDesktopOnly===!0&&e.addClass("qps-desktop-only"),n.hasOwnProperty("toUpdate")&&n.toUpdate===!0&&e.toggleClass("qps-update",!0),t.filters===E.mostSwitched&&n.switched!==0&&e.toggleClass("qps-most-switched",!0),n.delayed&&(e.toggleClass("toggle-bullet-color",!0),e.style.setProperty("--bullet-content",`"${n.time}"`))},Kt=(s,n)=>{let e=s.name;s.isDesktopOnly&&(e="\u1D30"+e),e=e+`|${s.version}`;let i=new h.TextComponent(n).setValue(e).inputEl;return i.readOnly=!0,i},$t=async(s,n,e,t)=>{let{settings:i}=t.plugin,{installed:o}=i,a=e.id;n.addItem(u=>u.setTitle("Short info (i)").setIcon("text").onClick(()=>{new ce(t.plugin.app,t.plugin,o[a]).open()})),n.addItem(u=>u.setTitle("Plugin github (g)").setIcon("github").onClick(async()=>{await Q(s,t,o[a])}));let l=t.app.setting.openTabById(a);n.addItem(u=>u.setTitle("Plugin settings (s)").setIcon("settings").setDisabled(!l).onClick(async()=>{await oe(s,t,e)}));let r=await be(t,e);n.addItem(u=>u.setTitle("Modify hotkeys (h)").setIcon("plus-circle").setDisabled(!r).onClick(async()=>{await ae(s,t,e)}))},be=async function(s,n){var t,i;let e=await((i=(t=s.app.setting.openTabById("command-palette"))==null?void 0:t.app)==null?void 0:i.commands.commands);return ut(e,n.id)},Q=async(s,n,e)=>{var o;let t;if("repo"in e)t=e.repo;else{let a=e.id,{commPlugins:l}=n.plugin.settings,r=Object.values(l).find(u=>u.id===a);t=(o=r==null?void 0:r.repo)!=null?o:""}let i=`https://github.com/${t}`;window.open(i,"_blank")},Wt=(s,n)=>{n.createEl("span",{cls:"qps-toggle-plugins"},e=>{In(s,e),xn(s,e),vn(s,e)})};function st(s){let e=`https://www.moritzjung.dev/obsidian-stats/plugins/${(0,Bt.default)(s.id)}#plugin-download-chart`;window.open(e,"_blank")}var Ht=(s,n)=>{n.createEl("span",{cls:"qps-toggle-plugins"},e=>{Tn(s,e)})};async function me(s,n,e){var u;let{plugin:t}=s,{settings:i}=t,{groups:o,groupsComm:a,installed:l,commPlugins:r}=i;if(s instanceof P){if(o[n]){if(!o[n].hidden&&!e.length){new h.Notice("empty group",3e3);return}o[n].hidden=!o[n].hidden}e.forEach(c=>{if(o[n].hidden)l[c].groupInfo.hidden=!0;else{let p=!1;for(let d of l[c].groupInfo.groupIndices)o[d].hidden&&(p=!0);p||(l[c].groupInfo.hidden=!1)}})}else{if(a[n]){if(!a[n].hidden&&!e.length){new h.Notice("empty group",3e3);return}a[n].hidden=!((u=a[n])!=null&&u.hidden)}e.forEach(c=>{if(a[n].hidden)r[c].groupCommInfo.hidden=!0;else{let p=!1;for(let d of r[c].groupCommInfo.groupIndices)a[d].hidden&&(p=!0);p||(r[c].groupCommInfo.hidden=!1)}})}await m(s)}async function we(s,n){var t;let e=(t=K(n))==null?void 0:t.parentElement;if(e!=null&&e.classList.contains("button-container")){let i=R(n,e.parentElement);i&&(n instanceof P?await zt(s,n,i):Yt(s,n,i))}else if(e!=null&&e.classList.contains("button-container1")){let i=R(n,e.parentElement);i&&n instanceof O&&re(s,n,i)}}var Ce=0,Dn=300,jt,Qt;function je(s,n){Ce++,Ce===1&&(Qt=s.target,jt=setTimeout(()=>{we(s,n),Ce=0},Dn)),Ce===2&&(ye(s,n,Qt),Ce=0,clearTimeout(jt))}function ye(s,n,e){let t=e||K(n),i=t==null?void 0:t.closest(".qps-comm-block"),o=t==null?void 0:t.closest(".qps-groups-name"),a=t==null?void 0:t.closest(".qps-item-line input"),l=t==null?void 0:t.closest(".qps-circle-title-group");if(i){let r=R(n,i);if(!r)return;h.Platform.isMobile?setTimeout(()=>{new Y(n.plugin.app,n,r).open()},250):new Y(n.plugin.app,n,r).open()}if(a){let r=R(n,a.parentElement);if(!r)return;Ln(n,a,r)}if(o){let r=o==null?void 0:o.textContent,u=fe(r);wt(n,o,u)}if(l&&n instanceof P){let r=Ie(l),u=G(n,r);_e(n,r,l,u)}}var Ln=async(s,n,e)=>{if(e.id==="quick-plugin-switcher")return;let t=e.time.toString();if(s.isDblClick=!0,!n)return;let i=he(n,t);if(e.delayed)e.delayed=!1,s.isDblClick=!1,e.target===0||e.target===1||await s.app.plugins.enablePluginAndSave(e.id),await m(s);else{if(!i)return;let o=()=>{setTimeout(async()=>{await s.addDelay(e.id,i),s.isDblClick=!1},100)};i.onkeydown=a=>{a.key==="Enter"&&o()},i.onblur=o}};async function Qe(s,n){let e=K(n),t,i=e==null?void 0:e.closest(".qps-groups-name"),o=i==null?void 0:i.textContent,a=fe(o);if(i){await mt(s,n,a,i);return}if(n instanceof P?t=e==null?void 0:e.closest(".qps-item-line"):t=e==null?void 0:e.closest(".qps-comm-block"),t){let l=R(n,t);l&&(n instanceof P?n.app.isMobile||await zt(s,n,l):Yt(s,n,l))}}function Yt(s,n,e){s.preventDefault();let t=new h.Menu,i=e.id,o=z();o&&(t.addItem(a=>a.setTitle("Copy").onClick(async()=>{await navigator.clipboard.writeText(o)})),t.addItem(a=>a.setTitle("Translate (t)").onClick(async()=>{await ee(o)})),t.addSeparator()),h.Platform.isMobile&&(t.addItem(a=>{a.setTitle("View stats").setIcon("stats").onClick(async()=>{st(e)})}),t.addSeparator()),t.addItem(a=>{a.setTitle("Install plugin").setDisabled(A(i)||i==="quick-plugin-switcher").setIcon("log-in").onClick(async()=>{let l=await V(n,i);if(!l){new h.Notice(`Manifest ${i} not found`,2500);return}let r=l.version;await this.app.plugins.installPlugin(e.repo,r,l),await m(n)})}),t.addItem(a=>{let l=x(n,i);a.setTitle(l?"Disable plugin":"Enable plugin").setDisabled(!A(i)||i==="quick-plugin-switcher").setIcon(l?"poweroff":"power").onClick(async()=>{x(n,i)?await n.app.plugins.disablePluginAndSave(i):await n.app.plugins.enablePluginAndSave(i);let r=l?"disabled":"enabled";new h.Notice(`${e.name} ${r}`,2500),m(n)})}),t.addItem(a=>{a.setTitle("Uninstall plugin").setDisabled(!A(i)||i==="quick-plugin-switcher").setIcon("log-out").onClick(async()=>{try{await this.app.plugins.uninstallPlugin(i),new h.Notice(`${e.name} uninstalled`,2500),await m(n)}catch(l){new h.Notice(`Failed to uninstall ${e.name}: ${l.message}`,3500)}})}),this.app.isMobile&&(t.addSeparator(),t.addItem(a=>{a.setTitle("Plugin github").setIcon("github").onClick(async l=>{await Q(l,n,e)})}),t.addItem(a=>a.setTitle("open Readme (dbl touch)").setIcon("sticky-note").onClick(()=>{new Y(n.app,n,e).open()})),t.addSeparator(),xe(t,e,n,!0),t.addSeparator(),ve(n,t,e,!0),t.addItem(a=>{a.setTitle("Remove All groups").setDisabled(e.groupCommInfo.groupIndices.length===0).onClick(async()=>{await N(n,e)})})),s instanceof MouseEvent?t.showAtMouseEvent(s):t.showAtPosition(n.mousePosition)}async function zt(s,n,e){let{plugin:t}=n,i=new h.Menu;if(this.app.isMobile||i.addItem(o=>o.setTitle("Plugin folder (f)").setIcon("folder-open").onClick(async()=>{await De(n,e)})),this.app.isMobile?await $t(s,i,e,n):i.addItem(async o=>{o.setTitle("Plugin features").setIcon("package-plus");let a=o.setSubmenu();await $t(s,a,e,n)}),i.addSeparator(),i.addItem(o=>{if(h.Platform.isDesktop){let l=e.target!==void 0?`run on ${J[e.target]}`:"run on Both";o.setTitle(l)}let a=h.Platform.isMobile?i:o.setSubmenu();Object.keys(J).filter(l=>isNaN(Number(l))).forEach(l=>{let r=l;h.Platform.isMobile&&(r=`run on ${l}`),a.addItem(u=>{u.setTitle(r).onClick(async()=>{let c=J[l];if(e.isDesktopOnly&&c===1){new h.Notice("Plugin is only for desktop",2500);return}e.target=c,e.commandified&&(await qt(n,e),await qe(n,e)),e.enabled&&(c===1&&h.Platform.isDesktop||c===0&&h.Platform.isMobile?await this.app.plugins.disablePluginAndSave(e.id):(c===1&&h.Platform.isMobile||c===0&&h.Platform.isDesktop)&&!e.delayed?await Le(n,e.id):c===2&&!e.delayed&&await this.app.plugins.enablePluginAndSave(e.id)),await m(n)})})})}),A(e.id)&&(i.addSeparator(),i.addItem(o=>{var u;let a=!1;a=e.id==="quick-plugin-switcher";let l=n.app.vault.adapter.getFullPath((u=e.dir)!=null?u:"");if(l||(a=!0),h.Platform.isDesktop){let c=Be.join(l,"package.json");(0,Ue.existsSync)(c)&&(a=!0)}let{commPlugins:r}=t.settings;o.setTitle("Update plugin!").setDisabled(a).setIcon("rocket").onClick(async()=>{await Jt(n,e,r)})}),i.addItem(o=>{o.setTitle("Uninstall plugin").setDisabled(e.id==="quick-plugin-switcher").setIcon("log-out").onClick(async()=>{try{await this.app.plugins.uninstallPlugin(e.id),new h.Notice(`${e.name} uninstalled`,2500),await n.plugin.installedUpdate(),await m(n)}catch(a){new h.Notice(`Failed to uninstall ${e.name}: ${a.message}`,3500)}})}),h.Platform.isDesktop)){let o=e.commandified?"Remove command from plugin":"Add command to plugin",a=h.Platform.isDesktop&&e.target===1||h.Platform.isMobile&&e.target===0;i.addItem(l=>{l.setTitle(o).setIcon("arrow-right-left").setDisabled(a).onClick(async()=>{e.commandified?(delete e.commandified,await qt(n,e),await t.saveSettings()):(e.commandified=!0,await qe(n,e)),await t.saveSettings()})})}e.id!=="quick-plugin-switcher"&&(i.addSeparator(),this.app.isMobile?xe(i,e,n,!0):i.addItem(o=>{o.setTitle("Add to group").setIcon("user");let a=o.setSubmenu();xe(a,e,n)}),this.app.isMobile?(i.addSeparator(),ve(n,i,e,!0),i.addItem(o=>{o.setTitle("Remove All groups").setDisabled(e.groupInfo.groupIndices.length===0).onClick(async()=>{await N(n,e)})})):i.addItem(o=>{o.setTitle("Remove from group").setIcon("user-minus");let a=o.setSubmenu();a.addItem(l=>{l.setTitle("All groups").setDisabled(e.groupInfo.groupIndices.length===0).onClick(async()=>{await N(n,e)})}),ve(n,a,e)})),s instanceof MouseEvent?i.showAtMouseEvent(s):i.showAtPosition(n.mousePosition)}async function Jt(s,n,e){let{id:t,version:i}=n;if(!n.dir){new h.Notice("Not a published plugin",2500);return}let o=s.app.vault.adapter.getFullPath(n.dir);if(!o)return;if(h.Platform.isDesktop){let u=Be.join(o,"package.json");if((0,Ue.existsSync)(u))return}let a=await V(s,t);if(!a)return;let l=await xt(s,t,a),r=a.version;if(!(t in e))new h.Notice("Not a published plugin",2500);else if(!a)new h.Notice(`No manifest in ${e[t].repo}`,3500);else if(!l)new h.Notice(`can't update, version ${a.version} in repo has not been released!`);else if(r<=i)new h.Notice(`Already last version ${r}`,2500);else try{await s.app.plugins.installPlugin(e[t].repo,r,a),new h.Notice(`version ${i} updated to ${r}`,2500),n.version=r,await s.plugin.installedUpdate()}catch(u){console.error("install failed")}n.toUpdate=!1,await m(s)}var R=(s,n)=>{let{installed:e,commPlugins:t}=s.plugin.settings,i=n.getAttribute("data-plugin-id");if(s instanceof P){let o=Object.keys(e).find(a=>e[a].id===i);return e[o]}else{let o=Object.keys(t).find(a=>t[a].id===i);return t[o]}},Xe=(s,n,e)=>{s.app.isMobile?(n.addItem(t=>{t.setTitle("Clear group(s)").setIcon("user-minus")}),Ze(s,n,e),Rt(n,s)):n.addItem(t=>{t.setTitle("Clear group(s)").setIcon("user-minus");let i=t.setSubmenu();Ze(s,i,e),i.addSeparator(),Rt(i,s)})};function Rt(s,n){let{plugin:e}=n,{settings:t}=e,{installed:i,commPlugins:o,groups:a,groupsComm:l}=t;s.addItem(r=>{r.setTitle("All groups").onClick(async()=>{if(await W("Detach all groups from all plugins?",300))if(n instanceof P){for(let c in i)i[c].groupInfo.hidden=!1,i[c].groupInfo.groupIndices=[];for(let c in a)a[c].hidden=!1;await m(n),new h.Notice("All groups empty",2500)}else{for(let c in l)l[c].hidden=!1;for(let c in o)o[c].groupCommInfo.hidden=!1,o[c].groupCommInfo.groupIndices=[];await m(n),new h.Notice("All groups empty",2500)}else new h.Notice("Operation cancelled",2500)})})}async function qe(s,n){let e=s instanceof P?s.plugin:s;if(!n.commandified)return;let t=h.Platform.isDesktop&&n.target===1||h.Platform.isMobile&&n.target===0;e.addCommand({id:n.id+"-switcher",name:"\u21D4 switch "+n.name.toLocaleLowerCase(),callback:async()=>{let i=s.app.plugins.getPlugin(n.id);if(t){new h.Notice(`${n.name} not available on this platform`,2500);return}i?(new h.Notice(`${n.name} disabled`,2500),s.app.plugins.disablePlugin(n.id)):(new h.Notice(`${n.name} enabled`,2500),s.app.plugins.enablePlugin(n.id))}})}async function qt(s,n){let e=s.plugin.manifest.id+":",t=n.id+"-switcher";s.app.commands.removeCommand(e+t)}var P=class extends k.Modal{constructor(e,t){super(e);this.plugin=t;this.searchTyping=!0;this.isDblClick=!1;this.pressed=!1;this.searchInit=!0;this.getMousePosition=e=>{this.mousePosition={x:e.clientX,y:e.clientY}};this.getHandleKeyDown=async e=>{await An(e,this)};this.getHandleContextMenu=async e=>{this.isDblClick||await Qe(e,this)};this.getHandleDblClick=e=>{this.isDblClick||ye(e,this)};this.getHandleClick=e=>{this.isDblClick||we(e,this)};this.getHandleTouch=e=>{this.isDblClick||je(e,this)};this.addHeader=e=>{let{plugin:t}=this,{settings:i}=t;new k.DropdownComponent(e).addOptions({all:`All(${t.lengthAll})`,enabled:`Enabled(${t.lengthEnabled})`,disabled:`Disabled(${t.lengthDisabled})`,enabledFirst:`Enabled First(${t.lengthAll})`,mostSwitched:`Most Switched(${t.lengthAll})`,byGroup:"By Group",hidden:`Hidden(${ie(this,Object.keys(i.installed)).length})`}).setValue(i.filters).onChange(async o=>{i.filters=o,await m(this)}),Ut(this,e),Ee(this,e)};this.addDelay=async(e,t)=>{let{plugin:i}=this,{settings:o}=i,{installed:a}=o;a[e].delayed=!0,a[e].time=parseInt(t.value)||0,a[e].time===0&&(a[e].delayed=!1),a[e].delayed&&a[e].enabled&&await Le(this,e),await m(this)};this.plugin=t}removeListeners(){this.modalEl.removeEventListener("mousemove",this.getMousePosition),document.removeEventListener("keydown",this.getHandleKeyDown),this.modalEl.removeEventListener("contextmenu",this.getHandleContextMenu),k.Platform.isDesktop&&(this.modalEl.removeEventListener("dblclick",this.getHandleDblClick),this.modalEl.removeEventListener("click",this.getHandleClick)),k.Platform.isMobile&&this.modalEl.removeEventListener("touchstart",this.getHandleTouch)}container(){let{contentEl:e}=this;this.modalEl.addClass("qps-modal"),this.header=e.createEl("div",{cls:"qps-header"}),this.search=e.createEl("div",{cls:"qps-search"}),this.groups=e.createEl("div",{cls:"qps-groups"}),this.hotkeysDesc=e.createEl("p",{cls:"qps-hk-desc"}),this.items=e.createEl("div",{cls:"qps-items"}),this.modalEl.addEventListener("mousemove",this.getMousePosition),document.addEventListener("keydown",this.getHandleKeyDown),this.modalEl.addEventListener("contextmenu",this.getHandleContextMenu),k.Platform.isDesktop&&(this.modalEl.addEventListener("dblclick",this.getHandleDblClick),this.modalEl.addEventListener("click",this.getHandleClick)),k.Platform.isMobile&&this.modalEl.addEventListener("touchstart",this.getHandleTouch)}async onOpen(){this.removeListeners();let{plugin:e,contentEl:t}=this,{settings:i}=e;this.searchInit&&(i.search=""),this.searchInit=!0,t.empty(),this.container(),ke(this,L,i.numberOfGroups),this.addHeader(this.header),await Ge(this,this.search,"Search plugins"),Fe(this,this.search,"Author"),Wt(this,this.search),this.addGroups(this.groups),i.showHotKeys&&!this.app.isMobile&&this.setHotKeysdesc(),await this.addItems(i.search)}addGroups(e){let t=Object.values(L);for(let i=1;i<t.length;i++){let o=t[i];e.createEl("span",{cls:"qps-group-span-container"},a=>{a.createEl("span",{cls:"qps-circle-title-group"},u=>{it(this,u,i)});let l=a.createEl("span",{cls:"qps-groups-name",text:`${o}`},u=>{var g;let{plugin:c}=this,{settings:p}=c;((g=p.groups[i])==null?void 0:g.hidden)?(u.style.textDecoration="line-through",u.style.opacity="0.6"):u.style.textDecoration="none"}),r=`<span class="shortcut-number">${i}:</span>`;l.insertAdjacentHTML("afterbegin",r)})}this.app.isMobile?e.createSpan({text:"(\u{1F5B1}\uFE0Fx2)name,icon:delay (\u{1F5B1}\uFE0F...)context-menu"}):e.createSpan({text:"> (h)\u{1F441}\uFE0F (\u{1F5B1}\uFE0Fx2)name"})}setHotKeysdesc(){let e=this.plugin.settings.numberOfGroups;this.hotkeysDesc.createSpan({text:`(1-${e})\u2795 (0)\u274C (f)\u{1F4C1} `},t=>{t.createSpan({text:"(g)"},i=>{let o=i.createSpan({cls:"git-hub-icon"});(0,k.setIcon)(o,"github")}),t.createSpan({text:" (ctrl)\u2139\uFE0F (s)\u2699\uFE0F (h)\u2328\uFE0F "}),t.createSpan({cls:"qps-hk-desc-last-part",text:"(\u{1F5B1}\uFE0Fx2)delay"})})}async addItems(e){let{plugin:t}=this,{settings:i}=t,{installed:o,filters:a}=i,l=Nt(this,e,o);l=Pt(this,t,l),l.filter(u=>!(a!==E.byGroup&&o[u].groupInfo.hidden&&a!==E.hidden||a===E.enabled&&!o[u].enabled||a===E.disabled&&o[u].enabled)).forEach(u=>{let c=this.items.createEl("div",{cls:"qps-item-line"});On(this,o[u],c);let p=Kt(o[u],c);c.setAttribute("data-plugin-id",u),Vt(this,o[u],c),Hn(p,o[u]),this.app.isMobile&&c.createEl("div",{cls:"button-container"},d=>$e(d))})}onClose(){let{contentEl:e}=this;e.empty(),this.removeListeners()}};function it(s,n,e){var i;let{color:t}=F(e);if(n.style.backgroundColor=t,s instanceof P){let{settings:o}=s.plugin;n.textContent=((i=o.groups[e])!=null&&i.time?o.groups[e].time:"").toString()}}var On=(s,n,e)=>{var l;let t=n.target===1&&k.Platform.isDesktop||n.target===0&&k.Platform.isMobile,i=n.isDesktopOnly&&k.Platform.isMobile||t,o=(l=n.id==="quick-plugin-switcher"||i||t)!=null?l:!1,a=i?!1:n.enabled;new k.ToggleComponent(e).setValue(a).setDisabled(o).onChange(async()=>{await Ct(s,n)})},Hn=(s,n)=>{let e=n.groupInfo.groupIndices;if(e.length){if(e.length<3){let t=T(e);s.insertAdjacentHTML("afterend",t)}if(e.length>=3&&e.length<5){let[t,i,...o]=e,l=T([t,i]);s.insertAdjacentHTML("afterend",l);let r=T(o);s.insertAdjacentHTML("afterend",r)}else if(e.length>=5){let[t,i,o,a,...l]=e,r=[t,i],u=[o,a],c=T(r);s.insertAdjacentHTML("afterend",c);let p=T(u);s.insertAdjacentHTML("afterend",p);let d=T(l);s.insertAdjacentHTML("afterend",d)}}};async function An(s,n){var a,l;let e=K(n),t=e==null?void 0:e.closest(".qps-item-line"),i=e==null?void 0:e.closest(".qps-circle-title-group"),o=e==null?void 0:e.closest(".qps-groups-name");if(t){(a=document.querySelector(".qps-search-component input"))==null||a.blur(),n.searchTyping=!1;let r=R(n,t);r&&await Gn(n,s,r)}else(i||o)&&s.key==="h"?((l=document.querySelector(".qps-search-component input"))==null||l.blur(),n.searchTyping=!1,await ot(n,i,o)):n.searchTyping=!0}var ot=async(s,n,e)=>{let t;if(n)t=Ie(n);else{let o=e==null?void 0:e.textContent;t=fe(o)}let i=G(s,t);await me(s,t,i)},Gn=async(s,n,e)=>{let{plugin:t}=s,{settings:i}=t,{groups:o,installed:a}=i,l=i.numberOfGroups,r={g:async()=>await Q(n,s,e),s:async()=>await oe(n,s,e),h:async()=>await ae(n,s,e)};k.Platform.isDesktopApp&&(r.f=async()=>await De(s,e));let u=n.key;if(e.groupInfo||(e.groupInfo={groupIndices:[],groupWasEnabled:!1,hidden:!1},await m(s)),s.pressed||(Oe(s),s.isDblClick))return;let c=e.groupInfo.groupIndices,p=parseInt(u);if(p>0&&p<=l&&e.id!=="quick-plugin-switcher"){if(c.length===6)return;c.indexOf(p)===-1&&(c==null||c.push(p),o[p].hidden&&(a[e.id].groupInfo.hidden=!0),await m(s))}else if(u in r)r[u]();else if(n.metaKey||n.ctrlKey)new ce(t.app,t,e).open();else if((u==="Delete"||u==="Backspace"||u==="0")&&e.id!=="quick-plugin-switcher"){if(!c.length)return;if(c.length===1){let d=c[0];e.groupInfo.groupIndices=[],Te(d,s)&&(i.selectedGroup="SelectGroup"),await m(s)}else{let d=new k.Menu;d.addItem(g=>g.setTitle("Remove item group(s)").setDisabled(!0).setDisabled(!0)),d.addSeparator(),d.addItem(g=>g.setTitle("All").onClick(async()=>{await N(s,e)}));for(let g of c){let{emoji:f}=F(g);d.addItem(b=>b.setTitle(`${f} group ${g}`).onClick(async()=>{e.groupInfo.groupIndices=ne(e.groupInfo.groupIndices,g),await m(s)}))}d.showAtPosition(s.mousePosition)}}};var q=require("obsidian");var Ve=require("obsidian"),Ne=class extends Ve.AbstractInputSuggest{getSuggestions(n){let e=[];n=n.toLocaleLowerCase();for(let t of this.app.vault.getAllLoadedFiles())t instanceof Ve.TFolder&&t.path.toLocaleLowerCase().includes(n)&&e.push(t);return e}renderSuggestion(n,e){e.createEl("span",{text:n.path})}selectSuggestion(n){this.textInputEl.value=n.path,this.textInputEl.trigger("input"),this.close()}};var Ke=class extends q.PluginSettingTab{constructor(e,t){super(e,t);this.debouncedHandleChange=(0,q.debounce)(async(e,t,i)=>{t<this.lastConfirmedValues[e]?await W("Reducing number of groups, higher groups info will be lost",350)?(await this.handleGroupReduction(e,t),this.lastConfirmedValues[e]=t):i.setValue(this.lastConfirmedValues[e]):(this.plugin.settings[e]=t,this.lastConfirmedValues[e]=t,await this.plugin.saveSettings())},600,!0);this.plugin=t,this.lastConfirmedValues={numberOfGroups:this.plugin.settings.numberOfGroups,numberOfGroupsComm:this.plugin.settings.numberOfGroupsComm}}display(){let{containerEl:e}=this;e.empty(),this.addGroupSlider("Number of plugins groups","numberOfGroups"),this.addGroupSlider("Number of community plugins groups","numberOfGroupsComm"),new q.Setting(e).setName("Show hotkeys line reminder").addToggle(i=>{i.setValue(this.plugin.settings.showHotKeys).onChange(o=>{this.plugin.settings.showHotKeys=o,this.plugin.saveSettings()})}),new q.Setting(e).setName("Keep dropdowns last value").setDesc("If enabled, dropdowns will be kept in last value when opening the modal").addToggle(i=>{i.setValue(this.plugin.settings.keepDropDownValues).onChange(o=>{this.plugin.settings.keepDropDownValues=o,this.plugin.saveSettings()})});let t=new DocumentFragment;t.createDiv({},i=>{i.innerHTML=`
						Enter a new folder path or search it. <br>
						If you provide a non existing folder path, it will be created when adding a new note.<br> 
						If you delete the file in, you lose your notes`}),new q.Setting(e).setName("Community plugins notes folder").setDesc(t).addText(i=>{i.setPlaceholder("search or type new folder");let o=i.inputEl;new Ne(this.app,o),i.setValue(this.plugin.settings.commPluginsNotesFolder),o.onblur=async()=>{this.plugin.settings.commPluginsNotesFolder=i.getValue(),await this.plugin.saveSettings()}})}addGroupSlider(e,t){new q.Setting(this.containerEl).setName(e).setDesc("To treat plugins by groups").addSlider(i=>{i.setLimits(1,6,1).setValue(this.lastConfirmedValues[t]).setDynamicTooltip().onChange(o=>{this.debouncedHandleChange(t,o,i)})})}async handleGroupReduction(e,t){let{settings:i}=this.plugin,o=e==="numberOfGroups"?i.installed:i.commPlugins;for(let a in o){let l=o[a],r=e==="numberOfGroups"?l.groupInfo:l.groupCommInfo;r&&r.groupIndices&&(r.groupIndices=r.groupIndices.filter(u=>u<=t))}i[e]=t,await this.plugin.saveSettings()}};var We=class extends Pe.Plugin{constructor(){super(...arguments);this.lengthAll=0;this.lengthDisabled=0;this.lengthEnabled=0;this.reset=!1;this.exeAfterDelay=async e=>{let t=Date.now();if(t-this.settings.lastFetchExe<12e4){console.log("Skipping fetch: less than 2 minutes since last update");return}await e()?(this.settings.lastFetchExe=t,await this.saveSettings()):console.warn("Community plugins update failed, please check your connection")}}async onload(){await this.loadSettings(),this.app.workspace.onLayoutReady(this.initializePlugin.bind(this)),this.addSettingTab(new Ke(this.app,this)),this.addCommands()}async initializePlugin(){this.settings.savedVersion=this.manifest.version,await this.updateInstalledPlugins(),await this.setupPluginWrappers(),await this.syncEnabled(),await this.handleDelayedPlugins()}async updateInstalledPlugins(){let e=this.settings.installed||{},t=this.app.plugins.manifests||{};for(let i in e)i in t||delete e[i]}async setupPluginWrappers(){let{wrapper1:e,wrapper2:t}=this.wrapDisableEnablePluginAndSave(Object.keys(this.settings.installed),async()=>await this.saveSettings());this.register(e),this.register(t)}async syncEnabled(){let e=this.settings.installed;for(let t in e)x(this,t)!==e[t].enabled&&!e[t].delayed&&!(e[t].target===1||e[t].target===0)&&(e[t].enabled=!e[t].enabled);await this.saveSettings()}isPlatformMismatch(e){return e.target===1&&Pe.Platform.isDesktop||e.target===0&&Pe.Platform.isMobile}isPlatformDependent(e){return e.target===1||e.target===0}async handleDelayedPlugins(){let e=this.settings.installed;for(let t in e){let i=e[t];if(i.commandified&&await qe(this,i),(i.delayed||this.isPlatformDependent(i))&&i.enabled)if(this.isPlatformMismatch(i))await this.app.plugins.disablePlugin(t);else if(i.delayed){let o=i.time*1e3||0;setTimeout(async()=>await this.app.plugins.enablePlugin(t),o)}else await this.app.plugins.enablePlugin(t);e[t].toUpdate=!1}}addCommands(){this.addCommand({id:"quick-plugin-switcher-modal",name:"Open modal",callback:()=>this.openQuickPluginSwitcherModal()}),this.addRibbonIcon("toggle-right","Quick Plugin Switcher",e=>this.openQuickPluginSwitcherModal())}async openQuickPluginSwitcherModal(){this.settings.keepDropDownValues||(this.settings.filters=E.all,this.settings.filtersComm=D.all),await this.installedUpdate(),new P(this.app,this).open(),le(10),await this.exeAfterDelay(this.pluginsCommInfo.bind(this)),setTimeout(async()=>{await It(this)},700)}wrapDisableEnablePluginAndSave(e,t){let i=this.settings.installed||{},o=ze(this.app.plugins,{disablePluginAndSave(l){return async function(r){if(e.length){let u=e.find(c=>c===r&&!x(this,r));u&&(i[u].delayed&&i[u].time>0||i[u].target===1||i[u].target===0)&&(i[u].enabled=!1,t())}return l.call(this,r)}}}),a=ze(this.app.plugins,{enablePluginAndSave(l){return async function(r){let u=!1;if(e.length){let c=e.find(p=>p===r&&x(this,p));c&&i[c].delayed&&i[c].time>0&&(i[c].enabled=!0,u=!0,t())}return u?this.app.plugins.enablePlugin.call(this,r):l.call(this,r)}}});return{wrapper1:o,wrapper2:a}}async installedUpdate(){let e=this.settings.installed||{},t=this.app.plugins.manifests||{},i=[];for(let o in e)o in t?i.push(o):delete e[o];for(let o in t)if(i.find(l=>l===o))x(this,o)!==e[o].enabled&&(e[o].delayed||e[o].target===1||e[o].target===0?(e[o].delayed||e[o].target===1||e[o].target===0)&&x(this,o)&&(e[o].enabled=!0,await this.app.plugins.disablePluginAndSave(o),await this.app.plugins.enablePlugin(o)):e[o].enabled=!e[o].enabled),e[o]={...e[o],...t[o]};else{let l={enabled:x(this,o)||!1,switched:0,groupInfo:{hidden:!1,groupIndices:[],groupWasEnabled:!1},delayed:!1,time:0};e[o]={...t[o],...l}}this.getLength(),await this.saveSettings()}getLength(){let e=this.settings.installed;this.lengthAll=Object.keys(e).length,this.lengthEnabled=0,this.lengthDisabled=0;for(let t in e)e[t].enabled?this.lengthEnabled++:this.lengthDisabled++}async pluginsCommInfo(){console.warn("Fetching community plugins info...");try{let[e,t]=await Promise.all([He(dt),He(gt)]);if(!e||!t)return console.error("Failed to fetch plugin data or stats."),!1;let{commPlugins:i}=this.settings;return e.forEach(o=>{var l,r;let a=t[o.id]||{downloads:0,updated:0};i[o.id]={...i[o.id],...o,...a,groupCommInfo:((l=i[o.id])==null?void 0:l.groupCommInfo)||{hidden:!1,groupIndices:[]},hasNote:((r=i[o.id])==null?void 0:r.hasNote)||!1}}),this.settings.pluginStats={...this.settings.pluginStats,...t},this.settings.plugins=e.map(o=>o.id),await this.saveSettings(),console.log("Community plugins info updated successfully."),!0}catch(e){return console.error("Failed to process plugin data:",e),!1}}async loadSettings(){this.settings={...ft,...await this.loadData()}}async onExternalSettingsChange(){await this.loadSettings()}async saveSettings(){await this.saveData(this.settings)}};
